{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\n// Tailwind class name merger\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n\n// Format date for display\nexport function formatDate(date: string | Date): string {\n  const d = typeof date === 'string' ? new Date(date) : date;\n  return d.toLocaleDateString('en-US', {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric'\n  });\n}\n\n// Format datetime for display\nexport function formatDateTime(date: string | Date): string {\n  const d = typeof date === 'string' ? new Date(date) : date;\n  return d.toLocaleString('en-US', {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit'\n  });\n}\n\n// Check if survey is currently active\nexport function isSurveyActive(\n  isActive: boolean,\n  startDate: string | null,\n  endDate: string | null\n): boolean {\n  if (!isActive) return false;\n\n  const now = new Date();\n\n  if (startDate && new Date(startDate) > now) {\n    return false;\n  }\n\n  if (endDate && new Date(endDate) < now) {\n    return false;\n  }\n\n  return true;\n}\n\n// Format time spent in seconds to readable format\nexport function formatTimeSpent(seconds: number): string {\n  if (seconds < 60) {\n    return `${seconds}s`;\n  }\n  const minutes = Math.floor(seconds / 60);\n  const remainingSeconds = seconds % 60;\n  return `${minutes}m ${remainingSeconds}s`;\n}\n\n// Generate session ID\nexport function generateSessionId(): string {\n  return `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\n// Get or create session ID from localStorage\nexport function getOrCreateSessionId(forceNew: boolean = false): string {\n  if (typeof window === 'undefined') return '';\n\n  const storageKey = 'survey_session_id';\n  \n  // If forceNew is true, always generate a new session ID\n  if (forceNew) {\n    const sessionId = generateSessionId();\n    localStorage.setItem(storageKey, sessionId);\n    return sessionId;\n  }\n\n  let sessionId = localStorage.getItem(storageKey);\n\n  if (!sessionId) {\n    sessionId = generateSessionId();\n    localStorage.setItem(storageKey, sessionId);\n  }\n\n  return sessionId;\n}\n\n// End current session (clear session ID)\nexport function endSession(): void {\n  if (typeof window === 'undefined') return;\n  localStorage.removeItem('survey_session_id');\n}\n\n// Generate a new session ID and replace the old one\nexport function renewSessionId(): string {\n  endSession(); // First end the old session\n  return getOrCreateSessionId(true);\n}\n\n// Check if user has completed a survey\nexport function hasCompletedSurvey(surveyId: string): boolean {\n  if (typeof window === 'undefined') return false;\n\n  const completedSurveys = localStorage.getItem('completed_surveys');\n  if (!completedSurveys) return false;\n\n  const completed = JSON.parse(completedSurveys);\n  return completed.includes(surveyId);\n}\n\n// Mark survey as completed\nexport function markSurveyCompleted(surveyId: string): void {\n  if (typeof window === 'undefined') return;\n\n  const completedSurveys = localStorage.getItem('completed_surveys');\n  const completed = completedSurveys ? JSON.parse(completedSurveys) : [];\n\n  if (!completed.includes(surveyId)) {\n    completed.push(surveyId);\n    localStorage.setItem('completed_surveys', JSON.stringify(completed));\n  }\n}\n\n// Clear all completed surveys (useful for testing or allowing retakes)\nexport function clearCompletedSurveys(): void {\n  if (typeof window === 'undefined') return;\n  localStorage.removeItem('completed_surveys');\n}\n\n// Clear specific survey completion (allow retake)\nexport function clearSurveyCompletion(surveyId: string): void {\n  if (typeof window === 'undefined') return;\n\n  const completedSurveys = localStorage.getItem('completed_surveys');\n  if (!completedSurveys) return;\n\n  const completed = JSON.parse(completedSurveys);\n  const filtered = completed.filter((id: string) => id !== surveyId);\n  localStorage.setItem('completed_surveys', JSON.stringify(filtered));\n}\n\n// Calculate percentage\nexport function calculatePercentage(value: number, total: number): number {\n  if (total === 0) return 0;\n  return Math.round((value / total) * 100);\n}\n\n// Validate file type for media upload\nexport function isValidMediaFile(file: File): boolean {\n  const validTypes = [\n    'image/jpeg',\n    'image/jpg',\n    'image/png',\n    'image/gif',\n    'image/webp',\n    'video/mp4',\n    'video/webm',\n    'video/quicktime'\n  ];\n  return validTypes.includes(file.type);\n}\n\n// Format file size\nexport function formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 Bytes';\n\n  const k = 1024;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n\n  return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\n}\n\n// Get admin path from env\nexport function getAdminPath(): string {\n  return process.env.ADMIN_SECRET_PATH || 'admin-x9QpK7';\n}\n\n// Validate admin path in URL\nexport function isAdminPath(pathname: string): boolean {\n  const adminPath = getAdminPath();\n  return pathname.startsWith(`/${adminPath}`);\n}\n\n// Device and Browser Detection\nexport interface DeviceInfo {\n  device_type: 'mobile' | 'tablet' | 'desktop';\n  browser: string;\n  os: string;\n}\n\nexport function getDeviceInfo(): DeviceInfo {\n  if (typeof window === 'undefined') {\n    return { device_type: 'desktop', browser: 'Unknown', os: 'Unknown' };\n  }\n\n  const ua = navigator.userAgent;\n  \n  // Detect device type\n  let device_type: 'mobile' | 'tablet' | 'desktop' = 'desktop';\n  if (/iPad|Android(?!.*Mobile)|Tablet/i.test(ua)) {\n    device_type = 'tablet';\n  } else if (/Mobile|iPhone|iPod|Android|webOS|BlackBerry|IEMobile|Opera Mini/i.test(ua)) {\n    device_type = 'mobile';\n  }\n  \n  // Detect browser\n  let browser = 'Unknown';\n  if (/Edg\\//i.test(ua)) {\n    browser = 'Edge';\n  } else if (/Chrome/i.test(ua) && !/Chromium/i.test(ua)) {\n    browser = 'Chrome';\n  } else if (/Safari/i.test(ua) && !/Chrome/i.test(ua)) {\n    browser = 'Safari';\n  } else if (/Firefox/i.test(ua)) {\n    browser = 'Firefox';\n  } else if (/MSIE|Trident/i.test(ua)) {\n    browser = 'Internet Explorer';\n  } else if (/Opera|OPR/i.test(ua)) {\n    browser = 'Opera';\n  } else if (/Samsung/i.test(ua)) {\n    browser = 'Samsung Browser';\n  }\n  \n  // Detect OS\n  let os = 'Unknown';\n  if (/Windows/i.test(ua)) {\n    os = 'Windows';\n  } else if (/Mac OS X/i.test(ua) && !/iPhone|iPad|iPod/i.test(ua)) {\n    os = 'macOS';\n  } else if (/iPhone|iPad|iPod/i.test(ua)) {\n    os = 'iOS';\n  } else if (/Android/i.test(ua)) {\n    os = 'Android';\n  } else if (/Linux/i.test(ua)) {\n    os = 'Linux';\n  } else if (/CrOS/i.test(ua)) {\n    os = 'Chrome OS';\n  }\n  \n  return { device_type, browser, os };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 216, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/actions/tracking.ts"],"sourcesContent":["'use server';\n\nimport { supabaseAdmin } from '@/lib/supabase/admin';\nimport type { SessionTracking, RealtimeStats } from '@/lib/types';\n\nexport async function updateSessionTracking(data: {\n  survey_id: string;\n  session_id: string;\n  current_page: number;\n  question_id?: string;\n}) {\n  try {\n    // Check if session exists\n    const { data: existing, error: fetchError } = await supabaseAdmin\n      .from('session_tracking')\n      .select('*')\n      .eq('survey_id', data.survey_id)\n      .eq('session_id', data.session_id)\n      .single();\n\n    if (fetchError && fetchError.code !== 'PGRST116') {\n      throw fetchError;\n    }\n\n    const now = new Date().toISOString();\n\n    if (existing) {\n      // Calculate time spent on previous question/page\n      const lastActive = new Date(existing.last_active_at);\n      const timeSpentSeconds = Math.floor((Date.now() - lastActive.getTime()) / 1000);\n\n      // Update existing session\n      const { error: updateError } = await supabaseAdmin\n        .from('session_tracking')\n        .update({\n          current_page: data.current_page,\n          question_id: data.question_id || null,\n          time_spent_seconds: existing.time_spent_seconds + timeSpentSeconds,\n          last_active_at: now,\n        })\n        .eq('id', existing.id);\n\n      if (updateError) throw updateError;\n    } else {\n      // Insert new session\n      const { error: insertError } = await supabaseAdmin\n        .from('session_tracking')\n        .insert([\n          {\n            survey_id: data.survey_id,\n            session_id: data.session_id,\n            current_page: data.current_page,\n            question_id: data.question_id || null,\n            time_spent_seconds: 0,\n            last_active_at: now,\n          },\n        ]);\n\n      if (insertError) throw insertError;\n    }\n\n    return { success: true };\n  } catch (error) {\n    console.error('Update session tracking error:', error);\n    return { success: false, error: 'Failed to update session tracking' };\n  }\n}\n\nexport async function getActiveSessions(surveyId: string): Promise<{ success: boolean; data?: RealtimeStats; error?: string }> {\n  try {\n    // Get sessions active in last 2 minutes\n    const twoMinutesAgo = new Date(Date.now() - 2 * 60 * 1000).toISOString();\n\n    const { data: sessions, error } = await supabaseAdmin\n      .from('session_tracking')\n      .select(`\n        *,\n        question:questions(question_text)\n      `)\n      .eq('survey_id', surveyId)\n      .gte('last_active_at', twoMinutesAgo)\n      .order('last_active_at', { ascending: false });\n\n    if (error) throw error;\n\n    // Calculate stats\n    const activeSessions = (sessions || []).map((session: any) => ({\n      session_id: session.session_id,\n      current_page: session.current_page,\n      question_id: session.question_id,\n      question_text: session.question?.question_text,\n      time_spent_seconds: session.time_spent_seconds,\n      last_active_at: session.last_active_at,\n    }));\n\n    const totalTimeSpent = activeSessions.reduce(\n      (sum, session) => sum + session.time_spent_seconds,\n      0\n    );\n\n    const averageTime = activeSessions.length > 0\n      ? totalTimeSpent / activeSessions.length\n      : 0;\n\n    return {\n      success: true,\n      data: {\n        total_active_users: activeSessions.length,\n        active_sessions: activeSessions,\n        average_time_per_question: averageTime,\n      },\n    };\n  } catch (error) {\n    console.error('Get active sessions error:', error);\n    return { success: false, error: 'Failed to fetch active sessions' };\n  }\n}\n\nexport async function cleanupOldSessions() {\n  try {\n    // Remove sessions older than 1 hour\n    const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000).toISOString();\n\n    const { error } = await supabaseAdmin\n      .from('session_tracking')\n      .delete()\n      .lt('last_active_at', oneHourAgo);\n\n    if (error) throw error;\n\n    return { success: true };\n  } catch (error) {\n    console.error('Cleanup old sessions error:', error);\n    return { success: false, error: 'Failed to cleanup old sessions' };\n  }\n}\n\n// Track when a user clicks to view media (image/gif)\nexport async function trackMediaView(data: {\n  survey_id: string;\n  question_id: string;\n  session_id: string;\n}) {\n  try {\n    const { error } = await supabaseAdmin\n      .from('media_views')\n      .insert([\n        {\n          survey_id: data.survey_id,\n          question_id: data.question_id,\n          session_id: data.session_id,\n        },\n      ]);\n\n    if (error) throw error;\n\n    return { success: true };\n  } catch (error) {\n    console.error('Track media view error:', error);\n    return { success: false, error: 'Failed to track media view' };\n  }\n}\n\n// Get media view stats for a survey\nexport async function getMediaViewStats(surveyId: string) {\n  try {\n    // First, get all questions with media for this survey\n    const { data: questions, error: questionsError } = await supabaseAdmin\n      .from('questions')\n      .select('id, question_text, media_url')\n      .eq('survey_id', surveyId)\n      .not('media_url', 'is', null);\n\n    if (questionsError) throw questionsError;\n\n    // Then get all media views for this survey\n    const { data: views, error: viewsError } = await supabaseAdmin\n      .from('media_views')\n      .select('question_id')\n      .eq('survey_id', surveyId);\n\n    if (viewsError) throw viewsError;\n\n    // Count views per question\n    const viewCounts: Record<string, number> = {};\n    (views || []).forEach((view: any) => {\n      viewCounts[view.question_id] = (viewCounts[view.question_id] || 0) + 1;\n    });\n\n    // Build stats for all questions with media\n    const stats = (questions || [])\n      .filter((q: any) => q.media_url) // Only questions with media\n      .map((q: any) => ({\n        question_id: q.id,\n        question_text: q.question_text,\n        media_url: q.media_url,\n        view_count: viewCounts[q.id] || 0,\n      }));\n\n    return { \n      success: true, \n      data: stats\n    };\n  } catch (error) {\n    console.error('Get media view stats error:', error);\n    return { success: false, error: 'Failed to fetch media view stats' };\n  }\n}\n"],"names":[],"mappings":";;;;;;;MAKsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,yDAAA"}},
    {"offset": {"line": 230, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/components/ui/Button.tsx"],"sourcesContent":["import { ButtonHTMLAttributes, forwardRef } from 'react';\nimport { cn } from '@/lib/utils';\n\ninterface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {\n  variant?: 'primary' | 'secondary' | 'ghost' | 'danger';\n  size?: 'sm' | 'md' | 'lg';\n}\n\nconst Button = forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant = 'primary', size = 'md', ...props }, ref) => {\n    return (\n      <button\n        ref={ref}\n        className={cn(\n          'inline-flex items-center justify-center rounded-lg font-medium transition-colors',\n          'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary',\n          'disabled:pointer-events-none disabled:opacity-50',\n          {\n            'bg-primary text-white hover:bg-primary-hover active:scale-[0.98]':\n              variant === 'primary',\n            'bg-muted text-foreground hover:bg-border':\n              variant === 'secondary',\n            'hover:bg-muted': variant === 'ghost',\n            'bg-red-600 text-white hover:bg-red-700': variant === 'danger',\n          },\n          {\n            'h-9 px-3 text-sm': size === 'sm',\n            'h-11 px-6 text-base': size === 'md',\n            'h-14 px-8 text-lg': size === 'lg',\n          },\n          className\n        )}\n        {...props}\n      />\n    );\n  }\n);\n\nButton.displayName = 'Button';\n\nexport { Button };\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAOA,MAAM,uBAAS,IAAA,mNAAU,EACvB,CAAC,EAAE,SAAS,EAAE,UAAU,SAAS,EAAE,OAAO,IAAI,EAAE,GAAG,OAAO,EAAE;IAC1D,qBACE,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,yHAAE,EACX,oFACA,8EACA,oDACA;YACE,oEACE,YAAY;YACd,4CACE,YAAY;YACd,kBAAkB,YAAY;YAC9B,0CAA0C,YAAY;QACxD,GACA;YACE,oBAAoB,SAAS;YAC7B,uBAAuB,SAAS;YAChC,qBAAqB,SAAS;QAChC,GACA;QAED,GAAG,KAAK;;;;;;AAGf;AAGF,OAAO,WAAW,GAAG"}},
    {"offset": {"line": 266, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/components/ui/Select.tsx"],"sourcesContent":["import { SelectHTMLAttributes, forwardRef } from 'react';\nimport { cn } from '@/lib/utils';\n\ninterface SelectProps extends SelectHTMLAttributes<HTMLSelectElement> {\n  label?: string;\n  error?: string;\n  options: { value: string; label: string }[];\n}\n\nconst Select = forwardRef<HTMLSelectElement, SelectProps>(\n  ({ className, label, error, options, ...props }, ref) => {\n    return (\n      <div className=\"w-full\">\n        {label && (\n          <label className=\"block text-sm font-medium text-foreground mb-2\">\n            {label}\n          </label>\n        )}\n        <select\n          ref={ref}\n          className={cn(\n            'flex h-11 w-full rounded-lg border border-border bg-background px-4 py-2',\n            'text-base text-foreground',\n            'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary',\n            'disabled:cursor-not-allowed disabled:opacity-50',\n            error && 'border-red-500 focus-visible:ring-red-500',\n            className\n          )}\n          {...props}\n        >\n          {options.map((option) => (\n            <option key={option.value} value={option.value}>\n              {option.label}\n            </option>\n          ))}\n        </select>\n        {error && <p className=\"mt-1 text-sm text-red-600\">{error}</p>}\n      </div>\n    );\n  }\n);\n\nSelect.displayName = 'Select';\n\nexport { Select };\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAQA,MAAM,uBAAS,IAAA,mNAAU,EACvB,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG,OAAO,EAAE;IAC/C,qBACE,8OAAC;QAAI,WAAU;;YACZ,uBACC,8OAAC;gBAAM,WAAU;0BACd;;;;;;0BAGL,8OAAC;gBACC,KAAK;gBACL,WAAW,IAAA,yHAAE,EACX,4EACA,6BACA,8EACA,mDACA,SAAS,6CACT;gBAED,GAAG,KAAK;0BAER,QAAQ,GAAG,CAAC,CAAC,uBACZ,8OAAC;wBAA0B,OAAO,OAAO,KAAK;kCAC3C,OAAO,KAAK;uBADF,OAAO,KAAK;;;;;;;;;;YAK5B,uBAAS,8OAAC;gBAAE,WAAU;0BAA6B;;;;;;;;;;;;AAG1D;AAGF,OAAO,WAAW,GAAG"}},
    {"offset": {"line": 326, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/components/ui/Card.tsx"],"sourcesContent":["import { HTMLAttributes, forwardRef } from 'react';\nimport { cn } from '@/lib/utils';\n\ninterface CardProps extends HTMLAttributes<HTMLDivElement> {}\n\nconst Card = forwardRef<HTMLDivElement, CardProps>(\n  ({ className, ...props }, ref) => {\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          'rounded-xl border border-border bg-background shadow-sm',\n          className\n        )}\n        {...props}\n      />\n    );\n  }\n);\n\nCard.displayName = 'Card';\n\nconst CardHeader = forwardRef<HTMLDivElement, HTMLAttributes<HTMLDivElement>>(\n  ({ className, ...props }, ref) => {\n    return (\n      <div\n        ref={ref}\n        className={cn('flex flex-col space-y-1.5 p-6', className)}\n        {...props}\n      />\n    );\n  }\n);\n\nCardHeader.displayName = 'CardHeader';\n\nconst CardTitle = forwardRef<\n  HTMLHeadingElement,\n  HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => {\n  return (\n    <h3\n      ref={ref}\n      className={cn('text-2xl font-semibold leading-none', className)}\n      {...props}\n    />\n  );\n});\n\nCardTitle.displayName = 'CardTitle';\n\nconst CardDescription = forwardRef<\n  HTMLParagraphElement,\n  HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  return (\n    <p\n      ref={ref}\n      className={cn('text-sm text-muted-foreground', className)}\n      {...props}\n    />\n  );\n});\n\nCardDescription.displayName = 'CardDescription';\n\nconst CardContent = forwardRef<HTMLDivElement, HTMLAttributes<HTMLDivElement>>(\n  ({ className, ...props }, ref) => {\n    return (\n      <div ref={ref} className={cn('p-6 pt-0', className)} {...props} />\n    );\n  }\n);\n\nCardContent.displayName = 'CardContent';\n\nconst CardFooter = forwardRef<HTMLDivElement, HTMLAttributes<HTMLDivElement>>(\n  ({ className, ...props }, ref) => {\n    return (\n      <div\n        ref={ref}\n        className={cn('flex items-center p-6 pt-0', className)}\n        {...props}\n      />\n    );\n  }\n);\n\nCardFooter.displayName = 'CardFooter';\n\nexport { Card, CardHeader, CardTitle, CardDescription, CardContent, CardFooter };\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA;AACA;;;;AAIA,MAAM,qBAAO,IAAA,mNAAU,EACrB,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE;IACxB,qBACE,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,yHAAE,EACX,2DACA;QAED,GAAG,KAAK;;;;;;AAGf;AAGF,KAAK,WAAW,GAAG;AAEnB,MAAM,2BAAa,IAAA,mNAAU,EAC3B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE;IACxB,qBACE,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,yHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;AAGF,WAAW,WAAW,GAAG;AAEzB,MAAM,0BAAY,IAAA,mNAAU,EAG1B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE;IAC1B,qBACE,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,yHAAE,EAAC,uCAAuC;QACpD,GAAG,KAAK;;;;;;AAGf;AAEA,UAAU,WAAW,GAAG;AAExB,MAAM,gCAAkB,IAAA,mNAAU,EAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE;IAC1B,qBACE,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,yHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;AAEA,gBAAgB,WAAW,GAAG;AAE9B,MAAM,4BAAc,IAAA,mNAAU,EAC5B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE;IACxB,qBACE,8OAAC;QAAI,KAAK;QAAK,WAAW,IAAA,yHAAE,EAAC,YAAY;QAAa,GAAG,KAAK;;;;;;AAElE;AAGF,YAAY,WAAW,GAAG;AAE1B,MAAM,2BAAa,IAAA,mNAAU,EAC3B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE;IACxB,qBACE,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,yHAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGf;AAGF,WAAW,WAAW,GAAG"}},
    {"offset": {"line": 423, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/lib/types.ts"],"sourcesContent":["// Database Types\nexport interface Survey {\n  id: string;\n  title: string;\n  description: string | null;\n  is_active: boolean;\n  start_date: string | null;\n  end_date: string | null;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface Category {\n  id: string;\n  survey_id: string;\n  name: string;\n  order_index: number;\n  created_at: string;\n}\n\nexport interface Question {\n  id: string;\n  survey_id: string;\n  category_id: string | null;\n  question_text: string;\n  description: string | null;\n  media_url: string | null;\n  question_type: QuestionType;\n  order_index: number;\n  created_at: string;\n}\n\nexport interface Response {\n  id: string;\n  survey_id: string;\n  question_id: string;\n  session_id: string;\n  age_range: AgeRange;\n  gender: Gender;\n  answer_value: string;\n  created_at: string;\n}\n\nexport interface SessionTracking {\n  id: string;\n  survey_id: string;\n  session_id: string;\n  current_page: number;\n  question_id: string | null;\n  time_spent_seconds: number;\n  last_active_at: string;\n  created_at: string;\n}\n\n// Enums\nexport enum QuestionType {\n  LIKE_DISLIKE = 'like_dislike',\n  RATING_1_5 = 'rating_1_5'\n}\n\nexport enum AgeRange {\n  RANGE_18_24 = '18-24',\n  RANGE_25_34 = '25-34',\n  RANGE_35_44 = '35-44',\n  RANGE_45_54 = '45-54',\n  RANGE_55_PLUS = '55+'\n}\n\nexport enum Gender {\n  MALE = 'male',\n  FEMALE = 'female',\n  OTHER = 'other',\n  PREFER_NOT_TO_SAY = 'prefer_not_to_say'\n}\n\n// Form Types\nexport interface SurveyFormData {\n  title: string;\n  description: string;\n  is_active: boolean;\n  start_date: string;\n  end_date: string;\n}\n\nexport interface CategoryFormData {\n  survey_id: string;\n  name: string;\n  order_index: number;\n}\n\nexport interface QuestionFormData {\n  survey_id: string;\n  category_id: string;\n  question_text: string;\n  description: string;\n  media_url: string;\n  question_type: QuestionType;\n  order_index: number;\n}\n\nexport interface ResponseFormData {\n  survey_id: string;\n  question_id: string;\n  session_id: string;\n  age_range: AgeRange;\n  gender: Gender;\n  answer_value: string;\n}\n\nexport interface DemographicsData {\n  age_range: AgeRange;\n  gender: Gender;\n}\n\n// Extended Types with Relations\nexport interface SurveyWithRelations extends Survey {\n  categories?: CategoryWithQuestions[];\n  questions?: Question[];\n  _count?: {\n    responses: number;\n  };\n}\n\nexport interface CategoryWithQuestions extends Category {\n  questions?: Question[];\n}\n\nexport interface QuestionWithDetails extends Question {\n  category?: Category;\n}\n\n// Aggregated Results\nexport interface QuestionResult {\n  question_id: string;\n  question_text: string;\n  question_type: QuestionType;\n  total_responses: number;\n  like_count?: number;\n  dislike_count?: number;\n  rating_1?: number;\n  rating_2?: number;\n  rating_3?: number;\n  rating_4?: number;\n  rating_5?: number;\n  average_rating?: number;\n}\n\nexport interface AggregatedResults {\n  survey_id: string;\n  total_responses: number;\n  by_age: Record<AgeRange, number>;\n  by_gender: Record<Gender, number>;\n  by_device: Record<string, number>;\n  by_browser: Record<string, number>;\n  by_os: Record<string, number>;\n  questions: QuestionResult[];\n}\n\n// Realtime Tracking\nexport interface ActiveSession {\n  session_id: string;\n  current_page: number;\n  question_id: string | null;\n  question_text?: string;\n  time_spent_seconds: number;\n  last_active_at: string;\n}\n\nexport interface RealtimeStats {\n  total_active_users: number;\n  active_sessions: ActiveSession[];\n  average_time_per_question: number;\n}\n\n// Admin Auth\nexport interface AdminSession {\n  authenticated: boolean;\n  expiresAt: number;\n}\n"],"names":[],"mappings":"AAAA,iBAAiB;;;;;;;;;AAuDV,IAAA,AAAK,sCAAA;;;WAAA;;AAKL,IAAA,AAAK,kCAAA;;;;;;WAAA;;AAQL,IAAA,AAAK,gCAAA;;;;;WAAA"}},
    {"offset": {"line": 456, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/components/survey/DemographicsStep.tsx"],"sourcesContent":["'use client';\n\nimport { useState } from 'react';\nimport { Button } from '@/components/ui/Button';\nimport { Select } from '@/components/ui/Select';\nimport { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/Card';\nimport { AgeRange, Gender, type DemographicsData } from '@/lib/types';\n\ninterface DemographicsStepProps {\n  onSubmit: (data: DemographicsData) => void;\n}\n\nexport function DemographicsStep({ onSubmit }: DemographicsStepProps) {\n  const [ageRange, setAgeRange] = useState<AgeRange | ''>('');\n  const [gender, setGender] = useState<Gender | ''>('');\n  const [error, setError] = useState('');\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    // Validate that both fields are selected\n    if (!ageRange || !gender) {\n      setError('Please select both age range and gender to continue');\n      return;\n    }\n    \n    setError('');\n    onSubmit({ age_range: ageRange as AgeRange, gender: gender as Gender });\n  };\n\n  const ageOptions = [\n    { value: '', label: 'Select your age range *' },\n    { value: AgeRange.RANGE_18_24, label: '18-24' },\n    { value: AgeRange.RANGE_25_34, label: '25-34' },\n    { value: AgeRange.RANGE_35_44, label: '35-44' },\n    { value: AgeRange.RANGE_45_54, label: '45-54' },\n    { value: AgeRange.RANGE_55_PLUS, label: '55+' },\n  ];\n\n  const genderOptions = [\n    { value: '', label: 'Select your gender *' },\n    { value: Gender.MALE, label: 'Male' },\n    { value: Gender.FEMALE, label: 'Female' },\n    { value: Gender.OTHER, label: 'Other' },\n    { value: Gender.PREFER_NOT_TO_SAY, label: 'Prefer not to say' },\n  ];\n\n  return (\n    <Card className=\"border-primary/20\">\n      <CardHeader>\n        <div className=\"flex items-center justify-center mb-4\">\n          <div className=\"text-6xl heart-pulse\">üíñ</div>\n        </div>\n        <CardTitle className=\"text-center\">Welcome! Your Privacy Matters</CardTitle>\n        <CardDescription className=\"text-center\">\n          This survey is <strong className=\"text-primary\">100% anonymous</strong>. We only collect age range and gender - no personal information, no tracking, no data sharing.\n        </CardDescription>\n        \n        {/* Privacy Badges */}\n        <div className=\"flex flex-wrap gap-2 justify-center mt-4\">\n          <span className=\"privacy-badge\">\n            üîí Fully Anonymous\n          </span>\n          <span className=\"privacy-badge\">\n            üõ°Ô∏è Secure & Private\n          </span>\n          <span className=\"privacy-badge\">\n            ‚ù§Ô∏è Your Voice Matters\n          </span>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n          <Select\n            label=\"Age Range\"\n            options={ageOptions}\n            value={ageRange}\n            onChange={(e) => {\n              setAgeRange(e.target.value as AgeRange);\n              setError('');\n            }}\n            required\n          />\n\n          <Select\n            label=\"Gender\"\n            options={genderOptions}\n            value={gender}\n            onChange={(e) => {\n              setGender(e.target.value as Gender);\n              setError('');\n            }}\n            required\n          />\n\n          {error && (\n            <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg\">\n              <p className=\"text-sm text-red-600 text-center\">‚ö†Ô∏è {error}</p>\n            </div>\n          )}\n\n          <Button \n            type=\"submit\" \n            size=\"lg\" \n            className=\"w-full\"\n            disabled={!ageRange || !gender}\n          >\n            Start Survey üíñ\n          </Button>\n\n          <p className=\"text-xs text-center text-muted-foreground\">\n            * All fields are required to continue\n          </p>\n        </form>\n      </CardContent>\n    </Card>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AANA;;;;;;;AAYO,SAAS,iBAAiB,EAAE,QAAQ,EAAyB;IAClE,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAgB;IACxD,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAc;IAClD,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IAEnC,MAAM,eAAe,CAAC;QACpB,EAAE,cAAc;QAEhB,yCAAyC;QACzC,IAAI,CAAC,YAAY,CAAC,QAAQ;YACxB,SAAS;YACT;QACF;QAEA,SAAS;QACT,SAAS;YAAE,WAAW;YAAsB,QAAQ;QAAiB;IACvE;IAEA,MAAM,aAAa;QACjB;YAAE,OAAO;YAAI,OAAO;QAA0B;QAC9C;YAAE,OAAO,+HAAQ,CAAC,WAAW;YAAE,OAAO;QAAQ;QAC9C;YAAE,OAAO,+HAAQ,CAAC,WAAW;YAAE,OAAO;QAAQ;QAC9C;YAAE,OAAO,+HAAQ,CAAC,WAAW;YAAE,OAAO;QAAQ;QAC9C;YAAE,OAAO,+HAAQ,CAAC,WAAW;YAAE,OAAO;QAAQ;QAC9C;YAAE,OAAO,+HAAQ,CAAC,aAAa;YAAE,OAAO;QAAM;KAC/C;IAED,MAAM,gBAAgB;QACpB;YAAE,OAAO;YAAI,OAAO;QAAuB;QAC3C;YAAE,OAAO,6HAAM,CAAC,IAAI;YAAE,OAAO;QAAO;QACpC;YAAE,OAAO,6HAAM,CAAC,MAAM;YAAE,OAAO;QAAS;QACxC;YAAE,OAAO,6HAAM,CAAC,KAAK;YAAE,OAAO;QAAQ;QACtC;YAAE,OAAO,6HAAM,CAAC,iBAAiB;YAAE,OAAO;QAAoB;KAC/D;IAED,qBACE,8OAAC,wIAAI;QAAC,WAAU;;0BACd,8OAAC,8IAAU;;kCACT,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC;4BAAI,WAAU;sCAAuB;;;;;;;;;;;kCAExC,8OAAC,6IAAS;wBAAC,WAAU;kCAAc;;;;;;kCACnC,8OAAC,mJAAe;wBAAC,WAAU;;4BAAc;0CACxB,8OAAC;gCAAO,WAAU;0CAAe;;;;;;4BAAuB;;;;;;;kCAIzE,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAK,WAAU;0CAAgB;;;;;;0CAGhC,8OAAC;gCAAK,WAAU;0CAAgB;;;;;;0CAGhC,8OAAC;gCAAK,WAAU;0CAAgB;;;;;;;;;;;;;;;;;;0BAKpC,8OAAC,+IAAW;0BACV,cAAA,8OAAC;oBAAK,UAAU;oBAAc,WAAU;;sCACtC,8OAAC,4IAAM;4BACL,OAAM;4BACN,SAAS;4BACT,OAAO;4BACP,UAAU,CAAC;gCACT,YAAY,EAAE,MAAM,CAAC,KAAK;gCAC1B,SAAS;4BACX;4BACA,QAAQ;;;;;;sCAGV,8OAAC,4IAAM;4BACL,OAAM;4BACN,SAAS;4BACT,OAAO;4BACP,UAAU,CAAC;gCACT,UAAU,EAAE,MAAM,CAAC,KAAK;gCACxB,SAAS;4BACX;4BACA,QAAQ;;;;;;wBAGT,uBACC,8OAAC;4BAAI,WAAU;sCACb,cAAA,8OAAC;gCAAE,WAAU;;oCAAmC;oCAAI;;;;;;;;;;;;sCAIxD,8OAAC,4IAAM;4BACL,MAAK;4BACL,MAAK;4BACL,WAAU;4BACV,UAAU,CAAC,YAAY,CAAC;sCACzB;;;;;;sCAID,8OAAC;4BAAE,WAAU;sCAA4C;;;;;;;;;;;;;;;;;;;;;;;AAOnE"}},
    {"offset": {"line": 716, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/lib/supabase/client.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  throw new Error('Missing Supabase environment variables');\n}\n\n// Browser client for public operations (anonymous surveys)\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey, {\n  auth: {\n    persistSession: false,\n    autoRefreshToken: false,\n  },\n});\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM;AAEN;;AAKO,MAAM,WAAW,IAAA,8LAAY,EAAC,aAAa,iBAAiB;IACjE,MAAM;QACJ,gBAAgB;QAChB,kBAAkB;IACpB;AACF"}},
    {"offset": {"line": 736, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/components/survey/LikeDislikeInput.tsx"],"sourcesContent":["'use client';\n\nimport { cn } from '@/lib/utils';\n\ninterface LikeDislikeInputProps {\n  value: string | null;\n  onChange: (value: string) => void;\n}\n\nexport function LikeDislikeInput({ value, onChange }: LikeDislikeInputProps) {\n  return (\n    <div className=\"space-y-4\">\n      <p className=\"text-center text-sm font-medium text-muted-foreground\">\n        Please select one option *\n      </p>\n      <div className=\"grid grid-cols-2 gap-3 sm:gap-4\">\n        <button\n          type=\"button\"\n          onClick={() => onChange('like')}\n          className={cn(\n            \"group relative overflow-hidden rounded-xl sm:rounded-2xl border-2 bg-gradient-to-br from-white to-primary-lighter p-4 sm:p-6 transition-all hover:shadow-lg active:scale-95\",\n            value === 'like' \n              ? 'border-primary ring-2 ring-primary/30 scale-[1.02]' \n              : 'border-primary/30 hover:border-primary'\n          )}\n        >\n          <div className=\"flex flex-col items-center gap-2 sm:gap-3\">\n            <div className=\"text-4xl sm:text-5xl group-hover:scale-110 transition-transform\">üíñ</div>\n            <span className=\"text-base sm:text-lg font-bold text-primary\">\n              Love It!\n            </span>\n          </div>\n          {value === 'like' && (\n            <div className=\"absolute top-2 right-2 text-primary text-lg\">‚úì</div>\n          )}\n        </button>\n\n        <button\n          type=\"button\"\n          onClick={() => onChange('dislike')}\n          className={cn(\n            \"group relative overflow-hidden rounded-xl sm:rounded-2xl border-2 bg-gradient-to-br from-white to-gray-50 p-4 sm:p-6 transition-all hover:shadow-lg active:scale-95\",\n            value === 'dislike' \n              ? 'border-gray-500 ring-2 ring-gray-300 scale-[1.02]' \n              : 'border-gray-300 hover:border-gray-500'\n          )}\n        >\n          <div className=\"flex flex-col items-center gap-2 sm:gap-3\">\n            <div className=\"text-4xl sm:text-5xl group-hover:scale-110 transition-transform\">üíî</div>\n            <span className=\"text-base sm:text-lg font-bold text-gray-600\">\n              Not for me\n            </span>\n          </div>\n          {value === 'dislike' && (\n            <div className=\"absolute top-2 right-2 text-gray-600 text-lg\">‚úì</div>\n          )}\n        </button>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AASO,SAAS,iBAAiB,EAAE,KAAK,EAAE,QAAQ,EAAyB;IACzE,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAE,WAAU;0BAAwD;;;;;;0BAGrE,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBACC,MAAK;wBACL,SAAS,IAAM,SAAS;wBACxB,WAAW,IAAA,yHAAE,EACX,+KACA,UAAU,SACN,uDACA;;0CAGN,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAI,WAAU;kDAAkE;;;;;;kDACjF,8OAAC;wCAAK,WAAU;kDAA8C;;;;;;;;;;;;4BAI/D,UAAU,wBACT,8OAAC;gCAAI,WAAU;0CAA8C;;;;;;;;;;;;kCAIjE,8OAAC;wBACC,MAAK;wBACL,SAAS,IAAM,SAAS;wBACxB,WAAW,IAAA,yHAAE,EACX,uKACA,UAAU,YACN,sDACA;;0CAGN,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAI,WAAU;kDAAkE;;;;;;kDACjF,8OAAC;wCAAK,WAAU;kDAA+C;;;;;;;;;;;;4BAIhE,UAAU,2BACT,8OAAC;gCAAI,WAAU;0CAA+C;;;;;;;;;;;;;;;;;;;;;;;;AAM1E"}},
    {"offset": {"line": 865, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/components/survey/RatingInput.tsx"],"sourcesContent":["'use client';\n\nimport { useState } from 'react';\nimport { cn } from '@/lib/utils';\n\ninterface RatingInputProps {\n  value: string | null;\n  onChange: (value: string) => void;\n}\n\nexport function RatingInput({ value, onChange }: RatingInputProps) {\n  const [hoveredRating, setHoveredRating] = useState(0);\n  const selectedRating = value ? parseInt(value) : 0;\n\n  const ratings = [1, 2, 3, 4, 5];\n\n  return (\n    <div className=\"flex flex-col items-center gap-4 sm:gap-6\">\n      <div className=\"text-center px-4\">\n        <p className=\"text-base sm:text-lg font-semibold text-foreground mb-1 flex items-center justify-center gap-2\">\n          <span className=\"text-xl sm:text-2xl\">üíï</span>\n          How much do you love it?\n        </p>\n        <p className=\"text-xs text-muted-foreground\">\n          Tap to rate from 1 to 5 hearts *\n        </p>\n      </div>\n      <div className=\"flex justify-center gap-1 sm:gap-2 px-2\">\n        {ratings.map((rating) => {\n          const isSelected = selectedRating >= rating;\n          const isHovered = hoveredRating >= rating;\n          const showFilled = isSelected || isHovered;\n          \n          return (\n            <button\n              key={rating}\n              type=\"button\"\n              onClick={() => onChange(rating.toString())}\n              onMouseEnter={() => setHoveredRating(rating)}\n              onMouseLeave={() => setHoveredRating(0)}\n              className=\"group relative transition-all hover:scale-110 active:scale-95 touch-manipulation p-1\"\n            >\n              <div\n                className={cn(\n                  'flex items-center justify-center w-12 h-12 sm:w-14 sm:h-14 rounded-full transition-all',\n                  showFilled ? 'scale-110 drop-shadow-lg' : 'scale-100'\n                )}\n              >\n                <svg\n                  className=\"w-10 h-10 sm:w-12 sm:h-12 transition-all\"\n                  fill={showFilled ? '#E63946' : '#ffc0c7'}\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path d=\"M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z\" />\n                </svg>\n              </div>\n              <span\n                className={cn(\n                  'absolute -bottom-4 left-1/2 -translate-x-1/2 text-xs font-medium',\n                  showFilled ? 'text-primary' : 'text-muted-foreground'\n                )}\n              >\n                {rating}\n              </span>\n            </button>\n          );\n        })}\n      </div>\n      {selectedRating > 0 && (\n        <p className=\"text-sm text-primary font-medium\">\n          You selected: {selectedRating}/5\n        </p>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAUO,SAAS,YAAY,EAAE,KAAK,EAAE,QAAQ,EAAoB;IAC/D,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,iNAAQ,EAAC;IACnD,MAAM,iBAAiB,QAAQ,SAAS,SAAS;IAEjD,MAAM,UAAU;QAAC;QAAG;QAAG;QAAG;QAAG;KAAE;IAE/B,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAE,WAAU;;0CACX,8OAAC;gCAAK,WAAU;0CAAsB;;;;;;4BAAS;;;;;;;kCAGjD,8OAAC;wBAAE,WAAU;kCAAgC;;;;;;;;;;;;0BAI/C,8OAAC;gBAAI,WAAU;0BACZ,QAAQ,GAAG,CAAC,CAAC;oBACZ,MAAM,aAAa,kBAAkB;oBACrC,MAAM,YAAY,iBAAiB;oBACnC,MAAM,aAAa,cAAc;oBAEjC,qBACE,8OAAC;wBAEC,MAAK;wBACL,SAAS,IAAM,SAAS,OAAO,QAAQ;wBACvC,cAAc,IAAM,iBAAiB;wBACrC,cAAc,IAAM,iBAAiB;wBACrC,WAAU;;0CAEV,8OAAC;gCACC,WAAW,IAAA,yHAAE,EACX,0FACA,aAAa,6BAA6B;0CAG5C,cAAA,8OAAC;oCACC,WAAU;oCACV,MAAM,aAAa,YAAY;oCAC/B,SAAQ;8CAER,cAAA,8OAAC;wCAAK,GAAE;;;;;;;;;;;;;;;;0CAGZ,8OAAC;gCACC,WAAW,IAAA,yHAAE,EACX,oEACA,aAAa,iBAAiB;0CAG/B;;;;;;;uBA3BE;;;;;gBA+BX;;;;;;YAED,iBAAiB,mBAChB,8OAAC;gBAAE,WAAU;;oBAAmC;oBAC/B;oBAAe;;;;;;;;;;;;;AAKxC"}},
    {"offset": {"line": 1003, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/actions/tracking.ts"],"sourcesContent":["'use server';\n\nimport { supabaseAdmin } from '@/lib/supabase/admin';\nimport type { SessionTracking, RealtimeStats } from '@/lib/types';\n\nexport async function updateSessionTracking(data: {\n  survey_id: string;\n  session_id: string;\n  current_page: number;\n  question_id?: string;\n}) {\n  try {\n    // Check if session exists\n    const { data: existing, error: fetchError } = await supabaseAdmin\n      .from('session_tracking')\n      .select('*')\n      .eq('survey_id', data.survey_id)\n      .eq('session_id', data.session_id)\n      .single();\n\n    if (fetchError && fetchError.code !== 'PGRST116') {\n      throw fetchError;\n    }\n\n    const now = new Date().toISOString();\n\n    if (existing) {\n      // Calculate time spent on previous question/page\n      const lastActive = new Date(existing.last_active_at);\n      const timeSpentSeconds = Math.floor((Date.now() - lastActive.getTime()) / 1000);\n\n      // Update existing session\n      const { error: updateError } = await supabaseAdmin\n        .from('session_tracking')\n        .update({\n          current_page: data.current_page,\n          question_id: data.question_id || null,\n          time_spent_seconds: existing.time_spent_seconds + timeSpentSeconds,\n          last_active_at: now,\n        })\n        .eq('id', existing.id);\n\n      if (updateError) throw updateError;\n    } else {\n      // Insert new session\n      const { error: insertError } = await supabaseAdmin\n        .from('session_tracking')\n        .insert([\n          {\n            survey_id: data.survey_id,\n            session_id: data.session_id,\n            current_page: data.current_page,\n            question_id: data.question_id || null,\n            time_spent_seconds: 0,\n            last_active_at: now,\n          },\n        ]);\n\n      if (insertError) throw insertError;\n    }\n\n    return { success: true };\n  } catch (error) {\n    console.error('Update session tracking error:', error);\n    return { success: false, error: 'Failed to update session tracking' };\n  }\n}\n\nexport async function getActiveSessions(surveyId: string): Promise<{ success: boolean; data?: RealtimeStats; error?: string }> {\n  try {\n    // Get sessions active in last 2 minutes\n    const twoMinutesAgo = new Date(Date.now() - 2 * 60 * 1000).toISOString();\n\n    const { data: sessions, error } = await supabaseAdmin\n      .from('session_tracking')\n      .select(`\n        *,\n        question:questions(question_text)\n      `)\n      .eq('survey_id', surveyId)\n      .gte('last_active_at', twoMinutesAgo)\n      .order('last_active_at', { ascending: false });\n\n    if (error) throw error;\n\n    // Calculate stats\n    const activeSessions = (sessions || []).map((session: any) => ({\n      session_id: session.session_id,\n      current_page: session.current_page,\n      question_id: session.question_id,\n      question_text: session.question?.question_text,\n      time_spent_seconds: session.time_spent_seconds,\n      last_active_at: session.last_active_at,\n    }));\n\n    const totalTimeSpent = activeSessions.reduce(\n      (sum, session) => sum + session.time_spent_seconds,\n      0\n    );\n\n    const averageTime = activeSessions.length > 0\n      ? totalTimeSpent / activeSessions.length\n      : 0;\n\n    return {\n      success: true,\n      data: {\n        total_active_users: activeSessions.length,\n        active_sessions: activeSessions,\n        average_time_per_question: averageTime,\n      },\n    };\n  } catch (error) {\n    console.error('Get active sessions error:', error);\n    return { success: false, error: 'Failed to fetch active sessions' };\n  }\n}\n\nexport async function cleanupOldSessions() {\n  try {\n    // Remove sessions older than 1 hour\n    const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000).toISOString();\n\n    const { error } = await supabaseAdmin\n      .from('session_tracking')\n      .delete()\n      .lt('last_active_at', oneHourAgo);\n\n    if (error) throw error;\n\n    return { success: true };\n  } catch (error) {\n    console.error('Cleanup old sessions error:', error);\n    return { success: false, error: 'Failed to cleanup old sessions' };\n  }\n}\n\n// Track when a user clicks to view media (image/gif)\nexport async function trackMediaView(data: {\n  survey_id: string;\n  question_id: string;\n  session_id: string;\n}) {\n  try {\n    const { error } = await supabaseAdmin\n      .from('media_views')\n      .insert([\n        {\n          survey_id: data.survey_id,\n          question_id: data.question_id,\n          session_id: data.session_id,\n        },\n      ]);\n\n    if (error) throw error;\n\n    return { success: true };\n  } catch (error) {\n    console.error('Track media view error:', error);\n    return { success: false, error: 'Failed to track media view' };\n  }\n}\n\n// Get media view stats for a survey\nexport async function getMediaViewStats(surveyId: string) {\n  try {\n    // First, get all questions with media for this survey\n    const { data: questions, error: questionsError } = await supabaseAdmin\n      .from('questions')\n      .select('id, question_text, media_url')\n      .eq('survey_id', surveyId)\n      .not('media_url', 'is', null);\n\n    if (questionsError) throw questionsError;\n\n    // Then get all media views for this survey\n    const { data: views, error: viewsError } = await supabaseAdmin\n      .from('media_views')\n      .select('question_id')\n      .eq('survey_id', surveyId);\n\n    if (viewsError) throw viewsError;\n\n    // Count views per question\n    const viewCounts: Record<string, number> = {};\n    (views || []).forEach((view: any) => {\n      viewCounts[view.question_id] = (viewCounts[view.question_id] || 0) + 1;\n    });\n\n    // Build stats for all questions with media\n    const stats = (questions || [])\n      .filter((q: any) => q.media_url) // Only questions with media\n      .map((q: any) => ({\n        question_id: q.id,\n        question_text: q.question_text,\n        media_url: q.media_url,\n        view_count: viewCounts[q.id] || 0,\n      }));\n\n    return { \n      success: true, \n      data: stats\n    };\n  } catch (error) {\n    console.error('Get media view stats error:', error);\n    return { success: false, error: 'Failed to fetch media view stats' };\n  }\n}\n"],"names":[],"mappings":";;;;;;;MA0IsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,kDAAA"}},
    {"offset": {"line": 1017, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/components/survey/BlurredMedia.tsx"],"sourcesContent":["'use client';\n\nimport { useState } from 'react';\nimport { trackMediaView } from '@/actions/tracking';\n\ninterface BlurredMediaProps {\n  src: string;\n  alt?: string;\n  type: 'image' | 'video';\n  surveyId?: string;\n  questionId?: string;\n  sessionId?: string;\n}\n\nexport function BlurredMedia({ \n  src, \n  alt = 'Media content', \n  type,\n  surveyId,\n  questionId,\n  sessionId,\n}: BlurredMediaProps) {\n  const [isRevealed, setIsRevealed] = useState(false);\n  const [hasTracked, setHasTracked] = useState(false);\n\n  const handleReveal = async () => {\n    setIsRevealed(true);\n    \n    // Track the media view (only once per session)\n    if (!hasTracked && surveyId && questionId && sessionId) {\n      setHasTracked(true);\n      await trackMediaView({\n        survey_id: surveyId,\n        question_id: questionId,\n        session_id: sessionId,\n      });\n    }\n  };\n\n  if (type === 'video') {\n    // Videos don't get blurred, just show with controls\n    return (\n      <video\n        src={src}\n        controls\n        className=\"w-full max-w-2xl rounded-lg mx-auto\"\n      />\n    );\n  }\n\n  return (\n    <div className=\"relative w-full max-w-2xl mx-auto\">\n      {/* Image */}\n      <img\n        src={src}\n        alt={alt}\n        className={`w-full rounded-lg transition-all duration-300 ${\n          isRevealed ? 'blur-0' : 'blur-xl'\n        }`}\n      />\n\n      {/* Overlay - shown when blurred */}\n      {!isRevealed && (\n        <button\n          onClick={handleReveal}\n          className=\"absolute inset-0 flex flex-col items-center justify-center bg-black/30 rounded-lg cursor-pointer hover:bg-black/40 transition-colors\"\n        >\n          <div className=\"bg-white/90 backdrop-blur-sm rounded-xl px-6 py-4 shadow-lg text-center\">\n            <div className=\"text-3xl mb-2\">üëÅÔ∏è</div>\n            <p className=\"text-sm font-medium text-gray-800\">\n              Tap to view image\n            </p>\n            <p className=\"text-xs text-gray-500 mt-1\">\n              Content may be sensitive\n            </p>\n          </div>\n        </button>\n      )}\n\n      {/* Re-blur button - shown when revealed */}\n      {isRevealed && (\n        <button\n          onClick={() => setIsRevealed(false)}\n          className=\"absolute top-2 right-2 bg-black/50 hover:bg-black/70 text-white text-xs px-3 py-1.5 rounded-full transition-colors flex items-center gap-1\"\n        >\n          <span>üôà</span>\n          <span>Hide</span>\n        </button>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAcO,SAAS,aAAa,EAC3B,GAAG,EACH,MAAM,eAAe,EACrB,IAAI,EACJ,QAAQ,EACR,UAAU,EACV,SAAS,EACS;IAClB,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAC;IAC7C,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAC;IAE7C,MAAM,eAAe;QACnB,cAAc;QAEd,+CAA+C;QAC/C,IAAI,CAAC,cAAc,YAAY,cAAc,WAAW;YACtD,cAAc;YACd,MAAM,IAAA,wKAAc,EAAC;gBACnB,WAAW;gBACX,aAAa;gBACb,YAAY;YACd;QACF;IACF;IAEA,IAAI,SAAS,SAAS;QACpB,oDAAoD;QACpD,qBACE,8OAAC;YACC,KAAK;YACL,QAAQ;YACR,WAAU;;;;;;IAGhB;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBACC,KAAK;gBACL,KAAK;gBACL,WAAW,CAAC,8CAA8C,EACxD,aAAa,WAAW,WACxB;;;;;;YAIH,CAAC,4BACA,8OAAC;gBACC,SAAS;gBACT,WAAU;0BAEV,cAAA,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAI,WAAU;sCAAgB;;;;;;sCAC/B,8OAAC;4BAAE,WAAU;sCAAoC;;;;;;sCAGjD,8OAAC;4BAAE,WAAU;sCAA6B;;;;;;;;;;;;;;;;;YAQ/C,4BACC,8OAAC;gBACC,SAAS,IAAM,cAAc;gBAC7B,WAAU;;kCAEV,8OAAC;kCAAK;;;;;;kCACN,8OAAC;kCAAK;;;;;;;;;;;;;;;;;;AAKhB"}},
    {"offset": {"line": 1143, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/components/survey/QuestionStep.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { supabase } from '@/lib/supabase/client';\nimport { updateSessionTracking } from '@/actions/tracking';\nimport { getDeviceInfo } from '@/lib/utils';\nimport { Card, CardContent } from '@/components/ui/Card';\nimport { Button } from '@/components/ui/Button';\nimport { LikeDislikeInput } from './LikeDislikeInput';\nimport { RatingInput } from './RatingInput';\nimport { BlurredMedia } from './BlurredMedia';\nimport type { Question, DemographicsData } from '@/lib/types';\n\ninterface QuestionStepProps {\n  question: Question;\n  sessionId: string;\n  surveyId: string;\n  demographics: DemographicsData;\n  onAnswer: (questionId: string, answerValue: string) => void;\n  questionNumber: number;\n  totalQuestions: number;\n}\n\nexport function QuestionStep({\n  question,\n  sessionId,\n  surveyId,\n  demographics,\n  onAnswer,\n  questionNumber,\n  totalQuestions,\n}: QuestionStepProps) {\n  const [selectedValue, setSelectedValue] = useState<string | null>(null);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [startTime, setStartTime] = useState<number>(Date.now());\n\n  // Reset selected value and start time when question changes\n  useEffect(() => {\n    setSelectedValue(null);\n    setStartTime(Date.now());\n  }, [question.id]);\n\n  useEffect(() => {\n    // Track question view\n    updateSessionTracking({\n      survey_id: surveyId,\n      session_id: sessionId,\n      current_page: questionNumber,\n      question_id: question.id,\n    });\n  }, [question.id, sessionId, surveyId, questionNumber]);\n\n  const handleSubmit = async () => {\n    if (!selectedValue) return;\n    \n    setIsSubmitting(true);\n    \n    // Calculate time spent on this question\n    const timeSpentSeconds = Math.round((Date.now() - startTime) / 1000);\n    \n    // Get device info\n    const deviceInfo = getDeviceInfo();\n    \n    // Save response to database\n    const { error } = await supabase.from('responses').insert([\n      {\n        survey_id: surveyId,\n        question_id: question.id,\n        session_id: sessionId,\n        age_range: demographics.age_range,\n        gender: demographics.gender,\n        answer_value: selectedValue,\n        device_type: deviceInfo.device_type,\n        browser: deviceInfo.browser,\n        os: deviceInfo.os,\n        time_spent_seconds: timeSpentSeconds,\n      },\n    ]);\n\n    if (error) {\n      console.error('Error saving response:', error);\n      alert('Failed to save your response. Please try again.');\n      setIsSubmitting(false);\n      return;\n    }\n\n    // Move to next question\n    onAnswer(question.id, selectedValue);\n    setIsSubmitting(false);\n  };\n\n  const isLastQuestion = questionNumber === totalQuestions;\n\n  return (\n    <div className=\"space-y-6\">\n      <Card className=\"border-primary/20 shadow-lg\">\n        <CardContent className=\"pt-6\">\n          <div className=\"mb-4\">\n            <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2 sm:gap-0 mb-2\">\n              <h2 className=\"text-lg sm:text-xl font-bold text-foreground flex-1\">\n                {question.question_text}\n              </h2>\n              <span className=\"text-xs font-medium text-primary bg-primary-light px-2 py-1 rounded w-fit\">\n                Required *\n              </span>\n            </div>\n            {question.description && (\n              <p className=\"text-sm text-muted-foreground mt-2\">\n                {question.description}\n              </p>\n            )}\n          </div>\n\n          {question.media_url && (\n            <div className=\"mb-4\">\n              <BlurredMedia\n                src={question.media_url}\n                alt=\"Question media\"\n                type={question.media_url.match(/\\.(jpg|jpeg|png|gif|webp)$/i) ? 'image' : 'video'}\n                surveyId={surveyId}\n                questionId={question.id}\n                sessionId={sessionId}\n              />\n            </div>\n          )}\n\n          <div className=\"mt-6\">\n            {question.question_type === 'like_dislike' ? (\n              <LikeDislikeInput value={selectedValue} onChange={setSelectedValue} />\n            ) : (\n              <RatingInput value={selectedValue} onChange={setSelectedValue} />\n            )}\n          </div>\n\n          {/* Next Button */}\n          <div className=\"mt-6 pt-4 border-t border-border\">\n            <Button\n              onClick={handleSubmit}\n              disabled={!selectedValue || isSubmitting}\n              size=\"lg\"\n              className=\"w-full\"\n            >\n              {isSubmitting ? (\n                'Saving...'\n              ) : isLastQuestion ? (\n                'Submit Survey'\n              ) : (\n                <>Next Question ‚Üí</>\n              )}\n            </Button>\n            {!selectedValue && (\n              <p className=\"text-xs text-center text-muted-foreground mt-2\">\n                Please select an option above to continue\n              </p>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1367, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/components/survey/CompletionScreen.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport Link from 'next/link';\nimport { Card, CardContent } from '@/components/ui/Card';\nimport { Button } from '@/components/ui/Button';\n\ninterface CompletionScreenProps {\n  surveyTitle: string;\n}\n\nexport function CompletionScreen({ surveyTitle }: CompletionScreenProps) {\n  const [showConfetti, setShowConfetti] = useState(true);\n\n  useEffect(() => {\n    const timer = setTimeout(() => setShowConfetti(false), 3000);\n    return () => clearTimeout(timer);\n  }, []);\n\n  // Clear the current survey's session to allow new ones\n  useEffect(() => {\n    // This helps if user wants to test again in development\n    // In production, the localStorage prevents retaking\n  }, []);\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary/10 via-pink-50 to-red-50 p-6\">\n      {showConfetti && <Confetti />}\n      \n      <Card className=\"max-w-2xl w-full border-primary/30 shadow-2xl\">\n        <CardContent className=\"pt-12 pb-12 text-center\">\n          <div className=\"mb-6\">\n            <div className=\"inline-flex items-center justify-center w-24 h-24 bg-gradient-to-br from-primary to-pink-500 rounded-full mb-4 heart-pulse\">\n              <svg\n                className=\"w-14 h-14 text-white\"\n                fill=\"currentColor\"\n                viewBox=\"0 0 24 24\"\n              >\n                <path d=\"M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z\" />\n              </svg>\n            </div>\n            <h1 className=\"text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary to-pink-500 mb-3\">\n              Thank You! üíï\n            </h1>\n            <p className=\"text-lg text-muted-foreground mb-4\">\n              Your anonymous responses have been securely recorded\n            </p>\n            \n            {/* Privacy Confirmation */}\n            <div className=\"bg-primary-lighter border border-primary/30 rounded-xl p-4 mb-6\">\n              <p className=\"text-sm text-primary font-medium flex items-center justify-center gap-2\">\n                <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                  <path fillRule=\"evenodd\" d=\"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\n                </svg>\n                Your identity remains 100% private and anonymous\n              </p>\n            </div>\n          </div>\n\n          <div className=\"bg-gradient-to-br from-primary/10 to-pink-100 border-2 border-primary/30 rounded-2xl p-8 mb-6 relative overflow-hidden\">\n            <div className=\"absolute top-2 right-2 text-4xl opacity-20\">üíù</div>\n            <div className=\"absolute bottom-2 left-2 text-4xl opacity-20\">üíñ</div>\n            \n            <div className=\"mb-4\">\n              <span className=\"inline-block px-6 py-3 bg-gradient-to-r from-primary to-pink-500 text-white font-bold text-3xl rounded-xl shadow-lg\">\n                üéÅ $50 COUPON\n              </span>\n            </div>\n            <p className=\"text-xl font-medium text-foreground mb-2\">\n              Use code <span className=\"font-mono font-bold text-2xl text-primary bg-white px-3 py-1 rounded\">VIXEN50</span>\n            </p>\n            <p className=\"text-muted-foreground text-lg\">\n              on <a href=\"https://www.vixen.com\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"font-semibold text-primary hover:underline\">www.vixen.com</a>\n            </p>\n          </div>\n\n          <div className=\"space-y-2 text-sm text-muted-foreground\">\n            <p className=\"flex items-center justify-center gap-2\">\n              <span className=\"text-2xl\">üíù</span>\n              <span>We appreciate your honest feedback</span>\n            </p>\n            <p className=\"font-medium text-primary\">\n              Your voice helps us improve & serve you better\n            </p>\n          </div>\n\n          {/* Navigation Button */}\n          <div className=\"mt-8 flex justify-center\">\n            <Link href=\"/?new=true\">\n              <Button variant=\"primary\" size=\"lg\" className=\"gap-2\">\n                <span>üíñ</span>\n                Take Another Survey\n              </Button>\n            </Link>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nfunction Confetti() {\n  return (\n    <div className=\"fixed inset-0 pointer-events-none overflow-hidden\">\n      {[...Array(50)].map((_, i) => (\n        <div\n          key={i}\n          className=\"absolute animate-confetti\"\n          style={{\n            left: `${Math.random() * 100}%`,\n            top: '-10%',\n            animationDelay: `${Math.random() * 3}s`,\n            animationDuration: `${3 + Math.random() * 2}s`,\n          }}\n        >\n          <div\n            className=\"w-2 h-2 rounded-full\"\n            style={{\n              backgroundColor: ['#E63946', '#F1FAEE', '#A8DADC', '#457B9D', '#1D3557'][\n                Math.floor(Math.random() * 5)\n              ],\n            }}\n          />\n        </div>\n      ))}\n      <style jsx>{`\n        @keyframes confetti {\n          to {\n            transform: translateY(100vh) rotate(360deg);\n          }\n        }\n        .animate-confetti {\n          animation: confetti linear forwards;\n        }\n      `}</style>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;;AAWO,SAAS,iBAAiB,EAAE,WAAW,EAAyB;IACrE,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAC;IAEjD,IAAA,kNAAS,EAAC;QACR,MAAM,QAAQ,WAAW,IAAM,gBAAgB,QAAQ;QACvD,OAAO,IAAM,aAAa;IAC5B,GAAG,EAAE;IAEL,uDAAuD;IACvD,IAAA,kNAAS,EAAC;IACR,wDAAwD;IACxD,oDAAoD;IACtD,GAAG,EAAE;IAEL,qBACE,8OAAC;QAAI,WAAU;;YACZ,8BAAgB,8OAAC;;;;;0BAElB,8OAAC,wIAAI;gBAAC,WAAU;0BACd,cAAA,8OAAC,+IAAW;oBAAC,WAAU;;sCACrB,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAI,WAAU;8CACb,cAAA,8OAAC;wCACC,WAAU;wCACV,MAAK;wCACL,SAAQ;kDAER,cAAA,8OAAC;4CAAK,GAAE;;;;;;;;;;;;;;;;8CAGZ,8OAAC;oCAAG,WAAU;8CAAkG;;;;;;8CAGhH,8OAAC;oCAAE,WAAU;8CAAqC;;;;;;8CAKlD,8OAAC;oCAAI,WAAU;8CACb,cAAA,8OAAC;wCAAE,WAAU;;0DACX,8OAAC;gDAAI,WAAU;gDAAU,MAAK;gDAAe,SAAQ;0DACnD,cAAA,8OAAC;oDAAK,UAAS;oDAAU,GAAE;oDAAkR,UAAS;;;;;;;;;;;4CAClT;;;;;;;;;;;;;;;;;;sCAMZ,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAI,WAAU;8CAA6C;;;;;;8CAC5D,8OAAC;oCAAI,WAAU;8CAA+C;;;;;;8CAE9D,8OAAC;oCAAI,WAAU;8CACb,cAAA,8OAAC;wCAAK,WAAU;kDAAsH;;;;;;;;;;;8CAIxI,8OAAC;oCAAE,WAAU;;wCAA2C;sDAC7C,8OAAC;4CAAK,WAAU;sDAAuE;;;;;;;;;;;;8CAElG,8OAAC;oCAAE,WAAU;;wCAAgC;sDACxC,8OAAC;4CAAE,MAAK;4CAAwB,QAAO;4CAAS,KAAI;4CAAsB,WAAU;sDAA6C;;;;;;;;;;;;;;;;;;sCAIxI,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAE,WAAU;;sDACX,8OAAC;4CAAK,WAAU;sDAAW;;;;;;sDAC3B,8OAAC;sDAAK;;;;;;;;;;;;8CAER,8OAAC;oCAAE,WAAU;8CAA2B;;;;;;;;;;;;sCAM1C,8OAAC;4BAAI,WAAU;sCACb,cAAA,8OAAC,uKAAI;gCAAC,MAAK;0CACT,cAAA,8OAAC,4IAAM;oCAAC,SAAQ;oCAAU,MAAK;oCAAK,WAAU;;sDAC5C,8OAAC;sDAAK;;;;;;wCAAS;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAS/B;AAEA,SAAS;IACP,qBACE,8OAAC;kDAAc;;YACZ;mBAAI,MAAM;aAAI,CAAC,GAAG,CAAC,CAAC,GAAG,kBACtB,8OAAC;oBAGC,OAAO;wBACL,MAAM,GAAG,KAAK,MAAM,KAAK,IAAI,CAAC,CAAC;wBAC/B,KAAK;wBACL,gBAAgB,GAAG,KAAK,MAAM,KAAK,EAAE,CAAC,CAAC;wBACvC,mBAAmB,GAAG,IAAI,KAAK,MAAM,KAAK,EAAE,CAAC,CAAC;oBAChD;8DANU;8BAQV,cAAA,8OAAC;wBAEC,OAAO;4BACL,iBAAiB;gCAAC;gCAAW;gCAAW;gCAAW;gCAAW;6BAAU,CACtE,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,GAC5B;wBACH;kEALU;;;;;;mBAVP;;;;;;;;;;;;;;;AA+Bf"}},
    {"offset": {"line": 1712, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/components/survey/ProgressBar.tsx"],"sourcesContent":["'use client';\n\nimport { cn } from '@/lib/utils';\n\ninterface ProgressBarProps {\n  current: number;\n  total: number;\n  categoryName?: string;\n}\n\nexport function ProgressBar({ current, total, categoryName }: ProgressBarProps) {\n  const percentage = (current / total) * 100;\n\n  return (\n    <div className=\"mb-6 sm:mb-8\">\n      <div className=\"flex items-center justify-between mb-3\">\n        <div className=\"flex items-center gap-2\">\n          <span className=\"text-xl sm:text-2xl\">üíñ</span>\n          <div>\n            <span className=\"text-xs sm:text-sm font-medium text-foreground\">\n              Question {current} of {total}\n            </span>\n            {categoryName && (\n              <span className=\"ml-2 text-xs sm:text-sm text-muted-foreground hidden sm:inline\">\n                ‚Ä¢ {categoryName}\n              </span>\n            )}\n          </div>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <span className=\"text-[10px] sm:text-xs text-muted-foreground\">üîí Anonymous</span>\n          <span className=\"text-xs sm:text-sm font-bold text-primary\">\n            {Math.round(percentage)}%\n          </span>\n        </div>\n      </div>\n      <div className=\"w-full bg-gradient-to-r from-primary-lighter to-pink-50 rounded-full h-2 sm:h-3 border border-primary/20\">\n        <div\n          className=\"bg-gradient-to-r from-primary to-pink-500 h-full rounded-full transition-all duration-500 shadow-sm\"\n          style={{ width: `${percentage}%` }}\n        />\n      </div>\n      <p className=\"text-[10px] sm:text-xs text-center text-muted-foreground mt-2\">\n        Your responses are completely anonymous & secure\n      </p>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;;AAUO,SAAS,YAAY,EAAE,OAAO,EAAE,KAAK,EAAE,YAAY,EAAoB;IAC5E,MAAM,aAAa,AAAC,UAAU,QAAS;IAEvC,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAK,WAAU;0CAAsB;;;;;;0CACtC,8OAAC;;kDACC,8OAAC;wCAAK,WAAU;;4CAAiD;4CACrD;4CAAQ;4CAAK;;;;;;;oCAExB,8BACC,8OAAC;wCAAK,WAAU;;4CAAiE;4CAC5E;;;;;;;;;;;;;;;;;;;kCAKX,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAK,WAAU;0CAA+C;;;;;;0CAC/D,8OAAC;gCAAK,WAAU;;oCACb,KAAK,KAAK,CAAC;oCAAY;;;;;;;;;;;;;;;;;;;0BAI9B,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBACC,WAAU;oBACV,OAAO;wBAAE,OAAO,GAAG,WAAW,CAAC,CAAC;oBAAC;;;;;;;;;;;0BAGrC,8OAAC;gBAAE,WAAU;0BAAgE;;;;;;;;;;;;AAKnF"}},
    {"offset": {"line": 1846, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/components/survey/SurveyFlow.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { getOrCreateSessionId, hasCompletedSurvey, markSurveyCompleted } from '@/lib/utils';\nimport { updateSessionTracking } from '@/actions/tracking';\nimport { DemographicsStep } from './DemographicsStep';\nimport { QuestionStep } from './QuestionStep';\nimport { CompletionScreen } from './CompletionScreen';\nimport { ProgressBar } from './ProgressBar';\nimport type { Survey, Category, Question, DemographicsData } from '@/lib/types';\n\ninterface SurveyFlowProps {\n  survey: Survey;\n  categories: Category[];\n  questions: Question[];\n}\n\nexport function SurveyFlow({ survey, categories, questions }: SurveyFlowProps) {\n  const router = useRouter();\n  const [sessionId, setSessionId] = useState('');\n  const [currentStep, setCurrentStep] = useState(0); // 0 = demographics, 1+ = questions\n  const [demographics, setDemographics] = useState<DemographicsData | null>(null);\n  const [answers, setAnswers] = useState<Map<string, string>>(new Map());\n  const [isCompleted, setIsCompleted] = useState(false);\n\n  useEffect(() => {\n    // Get or create session ID (will be new if coming from \"Take Another Survey\")\n    const id = getOrCreateSessionId();\n    setSessionId(id);\n\n    // Check if this session has already completed this specific survey\n    if (hasCompletedSurvey(survey.id)) {\n      setIsCompleted(true);\n    }\n  }, [survey.id]);\n\n  useEffect(() => {\n    if (!sessionId) return;\n\n    // Track demographics step\n    if (currentStep === 0) {\n      updateSessionTracking({\n        survey_id: survey.id,\n        session_id: sessionId,\n        current_page: 0,\n      });\n    }\n  }, [currentStep, sessionId, survey.id]);\n\n  const handleDemographicsSubmit = (data: DemographicsData) => {\n    setDemographics(data);\n    setCurrentStep(1);\n  };\n\n  const handleQuestionAnswer = (questionId: string, answerValue: string) => {\n    setAnswers(new Map(answers.set(questionId, answerValue)));\n\n    // Move to next question or completion\n    if (currentStep < questions.length) {\n      setCurrentStep(currentStep + 1);\n    } else {\n      // Survey completed - mark as complete and end session\n      markSurveyCompleted(survey.id);\n      // End the current session so a new one is created next time\n      if (typeof window !== 'undefined') {\n        localStorage.removeItem('survey_session_id');\n      }\n      setIsCompleted(true);\n    }\n  };\n\n  if (isCompleted) {\n    return <CompletionScreen surveyTitle={survey.title} />;\n  }\n\n  if (currentStep === 0) {\n    return (\n      <div className=\"max-w-2xl mx-auto p-6\">\n        <div className=\"mb-6 text-center\">\n          <h1 className=\"text-xl sm:text-2xl font-semibold text-foreground mb-1\">\n            {survey.title}\n          </h1>\n          {survey.description && (\n            <p className=\"text-sm text-muted-foreground\">\n              {survey.description}\n            </p>\n          )}\n        </div>\n        <DemographicsStep onSubmit={handleDemographicsSubmit} />\n      </div>\n    );\n  }\n\n  const currentQuestion = questions[currentStep - 1];\n  const currentCategory = categories.find(\n    (cat) => cat.id === currentQuestion?.category_id\n  );\n\n  if (!currentQuestion) {\n    return <CompletionScreen surveyTitle={survey.title} />;\n  }\n\n  return (\n    <div className=\"max-w-3xl mx-auto p-6\">\n      {/* Privacy Notice Header */}\n      <div className=\"mb-6 text-center\">\n        <div className=\"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary-lighter to-pink-50 border border-primary/30 rounded-full shadow-sm\">\n          <span className=\"text-xl\">üîí</span>\n          <span className=\"text-sm font-medium text-primary\">\n            100% Anonymous & Secure Survey\n          </span>\n          <span className=\"text-xl\">üíñ</span>\n        </div>\n      </div>\n\n      <ProgressBar\n        current={currentStep}\n        total={questions.length}\n        categoryName={currentCategory?.name}\n      />\n\n      <QuestionStep\n        question={currentQuestion}\n        sessionId={sessionId}\n        surveyId={survey.id}\n        demographics={demographics!}\n        onAnswer={handleQuestionAnswer}\n        questionNumber={currentStep}\n        totalQuestions={questions.length}\n      />\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;;;;;;;;;;AAkBO,SAAS,WAAW,EAAE,MAAM,EAAE,UAAU,EAAE,SAAS,EAAmB;IAC3E,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC,IAAI,mCAAmC;IACtF,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAA0B;IAC1E,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAsB,IAAI;IAChE,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAE/C,IAAA,kNAAS,EAAC;QACR,8EAA8E;QAC9E,MAAM,KAAK,IAAA,2IAAoB;QAC/B,aAAa;QAEb,mEAAmE;QACnE,IAAI,IAAA,yIAAkB,EAAC,OAAO,EAAE,GAAG;YACjC,eAAe;QACjB;IACF,GAAG;QAAC,OAAO,EAAE;KAAC;IAEd,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,WAAW;QAEhB,0BAA0B;QAC1B,IAAI,gBAAgB,GAAG;YACrB,IAAA,+KAAqB,EAAC;gBACpB,WAAW,OAAO,EAAE;gBACpB,YAAY;gBACZ,cAAc;YAChB;QACF;IACF,GAAG;QAAC;QAAa;QAAW,OAAO,EAAE;KAAC;IAEtC,MAAM,2BAA2B,CAAC;QAChC,gBAAgB;QAChB,eAAe;IACjB;IAEA,MAAM,uBAAuB,CAAC,YAAoB;QAChD,WAAW,IAAI,IAAI,QAAQ,GAAG,CAAC,YAAY;QAE3C,sCAAsC;QACtC,IAAI,cAAc,UAAU,MAAM,EAAE;YAClC,eAAe,cAAc;QAC/B,OAAO;YACL,sDAAsD;YACtD,IAAA,0IAAmB,EAAC,OAAO,EAAE;YAC7B,4DAA4D;YAC5D;;YAGA,eAAe;QACjB;IACF;IAEA,IAAI,aAAa;QACf,qBAAO,8OAAC,oKAAgB;YAAC,aAAa,OAAO,KAAK;;;;;;IACpD;IAEA,IAAI,gBAAgB,GAAG;QACrB,qBACE,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAG,WAAU;sCACX,OAAO,KAAK;;;;;;wBAEd,OAAO,WAAW,kBACjB,8OAAC;4BAAE,WAAU;sCACV,OAAO,WAAW;;;;;;;;;;;;8BAIzB,8OAAC,oKAAgB;oBAAC,UAAU;;;;;;;;;;;;IAGlC;IAEA,MAAM,kBAAkB,SAAS,CAAC,cAAc,EAAE;IAClD,MAAM,kBAAkB,WAAW,IAAI,CACrC,CAAC,MAAQ,IAAI,EAAE,KAAK,iBAAiB;IAGvC,IAAI,CAAC,iBAAiB;QACpB,qBAAO,8OAAC,oKAAgB;YAAC,aAAa,OAAO,KAAK;;;;;;IACpD;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAK,WAAU;sCAAU;;;;;;sCAC1B,8OAAC;4BAAK,WAAU;sCAAmC;;;;;;sCAGnD,8OAAC;4BAAK,WAAU;sCAAU;;;;;;;;;;;;;;;;;0BAI9B,8OAAC,0JAAW;gBACV,SAAS;gBACT,OAAO,UAAU,MAAM;gBACvB,cAAc,iBAAiB;;;;;;0BAGjC,8OAAC,4JAAY;gBACX,UAAU;gBACV,WAAW;gBACX,UAAU,OAAO,EAAE;gBACnB,cAAc;gBACd,UAAU;gBACV,gBAAgB;gBAChB,gBAAgB,UAAU,MAAM;;;;;;;;;;;;AAIxC"}}]
}