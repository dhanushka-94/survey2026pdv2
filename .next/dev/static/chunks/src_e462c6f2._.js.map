{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/lib/supabase/client.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  throw new Error('Missing Supabase environment variables');\n}\n\n// Browser client for public operations (anonymous surveys)\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey, {\n  auth: {\n    persistSession: false,\n    autoRefreshToken: false,\n  },\n});\n"],"names":[],"mappings":";;;;AAEoB;AAFpB;;AAEA,MAAM;AACN,MAAM;AAEN;;AAKO,MAAM,WAAW,IAAA,iMAAY,EAAC,aAAa,iBAAiB;IACjE,MAAM;QACJ,gBAAgB;QAChB,kBAAkB;IACpB;AACF"}},
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/actions/tracking.ts"],"sourcesContent":["'use server';\n\nimport { supabaseAdmin } from '@/lib/supabase/admin';\nimport type { SessionTracking, RealtimeStats } from '@/lib/types';\n\nexport async function updateSessionTracking(data: {\n  survey_id: string;\n  session_id: string;\n  current_page: number;\n  question_id?: string;\n}) {\n  try {\n    // Check if session exists\n    const { data: existing, error: fetchError } = await supabaseAdmin\n      .from('session_tracking')\n      .select('*')\n      .eq('survey_id', data.survey_id)\n      .eq('session_id', data.session_id)\n      .single();\n\n    if (fetchError && fetchError.code !== 'PGRST116') {\n      throw fetchError;\n    }\n\n    const now = new Date().toISOString();\n\n    if (existing) {\n      // Calculate time spent on previous question/page\n      const lastActive = new Date(existing.last_active_at);\n      const timeSpentSeconds = Math.floor((Date.now() - lastActive.getTime()) / 1000);\n\n      // Update existing session\n      const { error: updateError } = await supabaseAdmin\n        .from('session_tracking')\n        .update({\n          current_page: data.current_page,\n          question_id: data.question_id || null,\n          time_spent_seconds: existing.time_spent_seconds + timeSpentSeconds,\n          last_active_at: now,\n        })\n        .eq('id', existing.id);\n\n      if (updateError) throw updateError;\n    } else {\n      // Insert new session\n      const { error: insertError } = await supabaseAdmin\n        .from('session_tracking')\n        .insert([\n          {\n            survey_id: data.survey_id,\n            session_id: data.session_id,\n            current_page: data.current_page,\n            question_id: data.question_id || null,\n            time_spent_seconds: 0,\n            last_active_at: now,\n          },\n        ]);\n\n      if (insertError) throw insertError;\n    }\n\n    return { success: true };\n  } catch (error) {\n    console.error('Update session tracking error:', error);\n    return { success: false, error: 'Failed to update session tracking' };\n  }\n}\n\nexport async function getActiveSessions(surveyId: string): Promise<{ success: boolean; data?: RealtimeStats; error?: string }> {\n  try {\n    // Get sessions active in last 2 minutes\n    const twoMinutesAgo = new Date(Date.now() - 2 * 60 * 1000).toISOString();\n\n    const { data: sessions, error } = await supabaseAdmin\n      .from('session_tracking')\n      .select(`\n        *,\n        question:questions(question_text)\n      `)\n      .eq('survey_id', surveyId)\n      .gte('last_active_at', twoMinutesAgo)\n      .order('last_active_at', { ascending: false });\n\n    if (error) throw error;\n\n    // Calculate stats\n    const activeSessions = (sessions || []).map((session: any) => ({\n      session_id: session.session_id,\n      current_page: session.current_page,\n      question_id: session.question_id,\n      question_text: session.question?.question_text,\n      time_spent_seconds: session.time_spent_seconds,\n      last_active_at: session.last_active_at,\n    }));\n\n    const totalTimeSpent = activeSessions.reduce(\n      (sum, session) => sum + session.time_spent_seconds,\n      0\n    );\n\n    const averageTime = activeSessions.length > 0\n      ? totalTimeSpent / activeSessions.length\n      : 0;\n\n    return {\n      success: true,\n      data: {\n        total_active_users: activeSessions.length,\n        active_sessions: activeSessions,\n        average_time_per_question: averageTime,\n      },\n    };\n  } catch (error) {\n    console.error('Get active sessions error:', error);\n    return { success: false, error: 'Failed to fetch active sessions' };\n  }\n}\n\nexport async function cleanupOldSessions() {\n  try {\n    // Remove sessions older than 1 hour\n    const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000).toISOString();\n\n    const { error } = await supabaseAdmin\n      .from('session_tracking')\n      .delete()\n      .lt('last_active_at', oneHourAgo);\n\n    if (error) throw error;\n\n    return { success: true };\n  } catch (error) {\n    console.error('Cleanup old sessions error:', error);\n    return { success: false, error: 'Failed to cleanup old sessions' };\n  }\n}\n\n// Track when a user clicks to view media (image/gif)\nexport async function trackMediaView(data: {\n  survey_id: string;\n  question_id: string;\n  session_id: string;\n}) {\n  try {\n    const { error } = await supabaseAdmin\n      .from('media_views')\n      .insert([\n        {\n          survey_id: data.survey_id,\n          question_id: data.question_id,\n          session_id: data.session_id,\n        },\n      ]);\n\n    if (error) throw error;\n\n    return { success: true };\n  } catch (error) {\n    console.error('Track media view error:', error);\n    return { success: false, error: 'Failed to track media view' };\n  }\n}\n\n// Get media view stats for a survey\nexport async function getMediaViewStats(surveyId: string) {\n  try {\n    // First, get all questions with media for this survey\n    const { data: questions, error: questionsError } = await supabaseAdmin\n      .from('questions')\n      .select('id, question_text, media_url')\n      .eq('survey_id', surveyId)\n      .not('media_url', 'is', null);\n\n    if (questionsError) throw questionsError;\n\n    // Then get all media views for this survey\n    const { data: views, error: viewsError } = await supabaseAdmin\n      .from('media_views')\n      .select('question_id')\n      .eq('survey_id', surveyId);\n\n    if (viewsError) throw viewsError;\n\n    // Count views per question\n    const viewCounts: Record<string, number> = {};\n    (views || []).forEach((view: any) => {\n      viewCounts[view.question_id] = (viewCounts[view.question_id] || 0) + 1;\n    });\n\n    // Build stats for all questions with media\n    const stats = (questions || [])\n      .filter((q: any) => q.media_url) // Only questions with media\n      .map((q: any) => ({\n        question_id: q.id,\n        question_text: q.question_text,\n        media_url: q.media_url,\n        view_count: viewCounts[q.id] || 0,\n      }));\n\n    return { \n      success: true, \n      data: stats\n    };\n  } catch (error) {\n    console.error('Get media view stats error:', error);\n    return { success: false, error: 'Failed to fetch media view stats' };\n  }\n}\n"],"names":[],"mappings":";;;;;;;MAoEsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,qDAAA"}},
    {"offset": {"line": 45, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\n// Tailwind class name merger\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n\n// Format date for display\nexport function formatDate(date: string | Date): string {\n  const d = typeof date === 'string' ? new Date(date) : date;\n  return d.toLocaleDateString('en-US', {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric'\n  });\n}\n\n// Format datetime for display\nexport function formatDateTime(date: string | Date): string {\n  const d = typeof date === 'string' ? new Date(date) : date;\n  return d.toLocaleString('en-US', {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit'\n  });\n}\n\n// Check if survey is currently active\nexport function isSurveyActive(\n  isActive: boolean,\n  startDate: string | null,\n  endDate: string | null\n): boolean {\n  if (!isActive) return false;\n\n  const now = new Date();\n\n  if (startDate && new Date(startDate) > now) {\n    return false;\n  }\n\n  if (endDate && new Date(endDate) < now) {\n    return false;\n  }\n\n  return true;\n}\n\n// Format time spent in seconds to readable format\nexport function formatTimeSpent(seconds: number): string {\n  if (seconds < 60) {\n    return `${seconds}s`;\n  }\n  const minutes = Math.floor(seconds / 60);\n  const remainingSeconds = seconds % 60;\n  return `${minutes}m ${remainingSeconds}s`;\n}\n\n// Generate session ID\nexport function generateSessionId(): string {\n  return `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\n// Get or create session ID from localStorage\nexport function getOrCreateSessionId(forceNew: boolean = false): string {\n  if (typeof window === 'undefined') return '';\n\n  const storageKey = 'survey_session_id';\n  \n  // If forceNew is true, always generate a new session ID\n  if (forceNew) {\n    const sessionId = generateSessionId();\n    localStorage.setItem(storageKey, sessionId);\n    return sessionId;\n  }\n\n  let sessionId = localStorage.getItem(storageKey);\n\n  if (!sessionId) {\n    sessionId = generateSessionId();\n    localStorage.setItem(storageKey, sessionId);\n  }\n\n  return sessionId;\n}\n\n// End current session (clear session ID)\nexport function endSession(): void {\n  if (typeof window === 'undefined') return;\n  localStorage.removeItem('survey_session_id');\n}\n\n// Generate a new session ID and replace the old one\nexport function renewSessionId(): string {\n  endSession(); // First end the old session\n  return getOrCreateSessionId(true);\n}\n\n// Check if user has completed a survey\nexport function hasCompletedSurvey(surveyId: string): boolean {\n  if (typeof window === 'undefined') return false;\n\n  const completedSurveys = localStorage.getItem('completed_surveys');\n  if (!completedSurveys) return false;\n\n  const completed = JSON.parse(completedSurveys);\n  return completed.includes(surveyId);\n}\n\n// Mark survey as completed\nexport function markSurveyCompleted(surveyId: string): void {\n  if (typeof window === 'undefined') return;\n\n  const completedSurveys = localStorage.getItem('completed_surveys');\n  const completed = completedSurveys ? JSON.parse(completedSurveys) : [];\n\n  if (!completed.includes(surveyId)) {\n    completed.push(surveyId);\n    localStorage.setItem('completed_surveys', JSON.stringify(completed));\n  }\n}\n\n// Clear all completed surveys (useful for testing or allowing retakes)\nexport function clearCompletedSurveys(): void {\n  if (typeof window === 'undefined') return;\n  localStorage.removeItem('completed_surveys');\n}\n\n// Clear specific survey completion (allow retake)\nexport function clearSurveyCompletion(surveyId: string): void {\n  if (typeof window === 'undefined') return;\n\n  const completedSurveys = localStorage.getItem('completed_surveys');\n  if (!completedSurveys) return;\n\n  const completed = JSON.parse(completedSurveys);\n  const filtered = completed.filter((id: string) => id !== surveyId);\n  localStorage.setItem('completed_surveys', JSON.stringify(filtered));\n}\n\n// Calculate percentage\nexport function calculatePercentage(value: number, total: number): number {\n  if (total === 0) return 0;\n  return Math.round((value / total) * 100);\n}\n\n// Validate file type for media upload\nexport function isValidMediaFile(file: File): boolean {\n  const validTypes = [\n    'image/jpeg',\n    'image/jpg',\n    'image/png',\n    'image/gif',\n    'image/webp',\n    'video/mp4',\n    'video/webm',\n    'video/quicktime'\n  ];\n  return validTypes.includes(file.type);\n}\n\n// Format file size\nexport function formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 Bytes';\n\n  const k = 1024;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n\n  return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\n}\n\n// Get admin path from env\nexport function getAdminPath(): string {\n  return process.env.ADMIN_SECRET_PATH || 'admin-x9QpK7';\n}\n\n// Validate admin path in URL\nexport function isAdminPath(pathname: string): boolean {\n  const adminPath = getAdminPath();\n  return pathname.startsWith(`/${adminPath}`);\n}\n\n// Device and Browser Detection\nexport interface DeviceInfo {\n  device_type: 'mobile' | 'tablet' | 'desktop';\n  browser: string;\n  os: string;\n}\n\nexport function getDeviceInfo(): DeviceInfo {\n  if (typeof window === 'undefined') {\n    return { device_type: 'desktop', browser: 'Unknown', os: 'Unknown' };\n  }\n\n  const ua = navigator.userAgent;\n  \n  // Detect device type\n  let device_type: 'mobile' | 'tablet' | 'desktop' = 'desktop';\n  if (/iPad|Android(?!.*Mobile)|Tablet/i.test(ua)) {\n    device_type = 'tablet';\n  } else if (/Mobile|iPhone|iPod|Android|webOS|BlackBerry|IEMobile|Opera Mini/i.test(ua)) {\n    device_type = 'mobile';\n  }\n  \n  // Detect browser\n  let browser = 'Unknown';\n  if (/Edg\\//i.test(ua)) {\n    browser = 'Edge';\n  } else if (/Chrome/i.test(ua) && !/Chromium/i.test(ua)) {\n    browser = 'Chrome';\n  } else if (/Safari/i.test(ua) && !/Chrome/i.test(ua)) {\n    browser = 'Safari';\n  } else if (/Firefox/i.test(ua)) {\n    browser = 'Firefox';\n  } else if (/MSIE|Trident/i.test(ua)) {\n    browser = 'Internet Explorer';\n  } else if (/Opera|OPR/i.test(ua)) {\n    browser = 'Opera';\n  } else if (/Samsung/i.test(ua)) {\n    browser = 'Samsung Browser';\n  }\n  \n  // Detect OS\n  let os = 'Unknown';\n  if (/Windows/i.test(ua)) {\n    os = 'Windows';\n  } else if (/Mac OS X/i.test(ua) && !/iPhone|iPad|iPod/i.test(ua)) {\n    os = 'macOS';\n  } else if (/iPhone|iPad|iPod/i.test(ua)) {\n    os = 'iOS';\n  } else if (/Android/i.test(ua)) {\n    os = 'Android';\n  } else if (/Linux/i.test(ua)) {\n    os = 'Linux';\n  } else if (/CrOS/i.test(ua)) {\n    os = 'Chrome OS';\n  }\n  \n  return { device_type, browser, os };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 283, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/components/ui/Select.tsx"],"sourcesContent":["import { SelectHTMLAttributes, forwardRef } from 'react';\nimport { cn } from '@/lib/utils';\n\ninterface SelectProps extends SelectHTMLAttributes<HTMLSelectElement> {\n  label?: string;\n  error?: string;\n  options: { value: string; label: string }[];\n}\n\nconst Select = forwardRef<HTMLSelectElement, SelectProps>(\n  ({ className, label, error, options, ...props }, ref) => {\n    return (\n      <div className=\"w-full\">\n        {label && (\n          <label className=\"block text-sm font-medium text-foreground mb-2\">\n            {label}\n          </label>\n        )}\n        <select\n          ref={ref}\n          className={cn(\n            'flex h-11 w-full rounded-lg border border-border bg-background px-4 py-2',\n            'text-base text-foreground',\n            'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary',\n            'disabled:cursor-not-allowed disabled:opacity-50',\n            error && 'border-red-500 focus-visible:ring-red-500',\n            className\n          )}\n          {...props}\n        >\n          {options.map((option) => (\n            <option key={option.value} value={option.value}>\n              {option.label}\n            </option>\n          ))}\n        </select>\n        {error && <p className=\"mt-1 text-sm text-red-600\">{error}</p>}\n      </div>\n    );\n  }\n);\n\nSelect.displayName = 'Select';\n\nexport { Select };\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAQA,MAAM,uBAAS,IAAA,2KAAU,OACvB,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG,OAAO,EAAE;IAC/C,qBACE,6LAAC;QAAI,WAAU;;YACZ,uBACC,6LAAC;gBAAM,WAAU;0BACd;;;;;;0BAGL,6LAAC;gBACC,KAAK;gBACL,WAAW,IAAA,4HAAE,EACX,4EACA,6BACA,8EACA,mDACA,SAAS,6CACT;gBAED,GAAG,KAAK;0BAER,QAAQ,GAAG,CAAC,CAAC,uBACZ,6LAAC;wBAA0B,OAAO,OAAO,KAAK;kCAC3C,OAAO,KAAK;uBADF,OAAO,KAAK;;;;;;;;;;YAK5B,uBAAS,6LAAC;gBAAE,WAAU;0BAA6B;;;;;;;;;;;;AAG1D;;AAGF,OAAO,WAAW,GAAG"}},
    {"offset": {"line": 350, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/components/ui/LoadingSpinner.tsx"],"sourcesContent":["'use client';\n\nimport { HTMLAttributes } from 'react';\nimport { cn } from '@/lib/utils';\n\ninterface LoadingSpinnerProps extends HTMLAttributes<HTMLDivElement> {\n  size?: 'sm' | 'md' | 'lg';\n}\n\nexport function LoadingSpinner({\n  size = 'md',\n  className,\n  ...props\n}: LoadingSpinnerProps) {\n  return (\n    <div\n      className={cn('flex items-center justify-center', className)}\n      {...props}\n    >\n      <div\n        className={cn('animate-spin rounded-full border-b-2 border-primary', {\n          'h-5 w-5': size === 'sm',\n          'h-8 w-8': size === 'md',\n          'h-12 w-12': size === 'lg',\n        })}\n      />\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAGA;AAHA;;;AASO,SAAS,eAAe,EAC7B,OAAO,IAAI,EACX,SAAS,EACT,GAAG,OACiB;IACpB,qBACE,6LAAC;QACC,WAAW,IAAA,4HAAE,EAAC,oCAAoC;QACjD,GAAG,KAAK;kBAET,cAAA,6LAAC;YACC,WAAW,IAAA,4HAAE,EAAC,uDAAuD;gBACnE,WAAW,SAAS;gBACpB,WAAW,SAAS;gBACpB,aAAa,SAAS;YACxB;;;;;;;;;;;AAIR;KAnBgB"}},
    {"offset": {"line": 390, "column": 0}, "map": {"version":3,"sources":["file:///Users/dhanushka/Desktop/survey/src/components/admin/RealtimeDashboard.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase/client';\nimport { getActiveSessions } from '@/actions/tracking';\nimport { Select } from '@/components/ui/Select';\nimport { LoadingSpinner } from '@/components/ui/LoadingSpinner';\nimport { formatTimeSpent, formatDateTime } from '@/lib/utils';\nimport type { Survey, RealtimeStats } from '@/lib/types';\n\ninterface RealtimeDashboardProps {\n  surveys: Survey[];\n}\n\nexport function RealtimeDashboard({ surveys }: RealtimeDashboardProps) {\n  const [selectedSurveyId, setSelectedSurveyId] = useState(surveys[0]?.id || '');\n  const [stats, setStats] = useState<RealtimeStats | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // Fetch active sessions\n  const fetchSessions = async () => {\n    if (!selectedSurveyId) return;\n\n    const result = await getActiveSessions(selectedSurveyId);\n    if (result.success && result.data) {\n      setStats(result.data);\n    }\n    setIsLoading(false);\n  };\n\n  // Initial fetch\n  useEffect(() => {\n    fetchSessions();\n  }, [selectedSurveyId]);\n\n  // Setup realtime subscription\n  useEffect(() => {\n    if (!selectedSurveyId) return;\n\n    const channel = supabase\n      .channel(`session_tracking:${selectedSurveyId}`)\n      .on(\n        'postgres_changes',\n        {\n          event: '*',\n          schema: 'public',\n          table: 'session_tracking',\n          filter: `survey_id=eq.${selectedSurveyId}`,\n        },\n        () => {\n          // Refetch data when session tracking changes\n          fetchSessions();\n        }\n      )\n      .subscribe();\n\n    // Refresh every 10 seconds\n    const interval = setInterval(fetchSessions, 10000);\n\n    return () => {\n      supabase.removeChannel(channel);\n      clearInterval(interval);\n    };\n  }, [selectedSurveyId]);\n\n  const surveyOptions = surveys.map((survey) => ({\n    value: survey.id,\n    label: survey.title,\n  }));\n\n  if (surveys.length === 0) {\n    return (\n      <p className=\"text-muted-foreground text-center py-8\">\n        No surveys available. Create a survey first.\n      </p>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <Select\n        label=\"Select Survey\"\n        options={surveyOptions}\n        value={selectedSurveyId}\n        onChange={(e) => setSelectedSurveyId(e.target.value)}\n      />\n\n      {isLoading ? (\n        <LoadingSpinner className=\"py-12\" />\n      ) : stats ? (\n        <>\n          {/* Stats Overview */}\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div className=\"p-6 border border-border rounded-lg bg-background\">\n              <p className=\"text-3xl font-bold text-primary\">\n                {stats.total_active_users}\n              </p>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                Active Users (Last 2 min)\n              </p>\n            </div>\n\n            <div className=\"p-6 border border-border rounded-lg bg-background\">\n              <p className=\"text-3xl font-bold text-primary\">\n                {stats.active_sessions.length}\n              </p>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                Total Sessions\n              </p>\n            </div>\n\n            <div className=\"p-6 border border-border rounded-lg bg-background\">\n              <p className=\"text-3xl font-bold text-primary\">\n                {formatTimeSpent(Math.round(stats.average_time_per_question))}\n              </p>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                Avg. Time Spent\n              </p>\n            </div>\n          </div>\n\n          {/* Active Sessions List */}\n          <div>\n            <h3 className=\"text-lg font-semibold mb-4\">Active Sessions</h3>\n            {stats.active_sessions.length === 0 ? (\n              <p className=\"text-muted-foreground text-center py-8\">\n                No active users at the moment\n              </p>\n            ) : (\n              <div className=\"space-y-3\">\n                {stats.active_sessions.map((session) => (\n                  <div\n                    key={session.session_id}\n                    className=\"p-4 border border-border rounded-lg bg-background hover:bg-muted/50 transition-colors\"\n                  >\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center gap-2 mb-2\">\n                          <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\" />\n                          <span className=\"text-sm font-mono text-muted-foreground\">\n                            Session: {session.session_id.substring(0, 16)}...\n                          </span>\n                        </div>\n                        <p className=\"text-sm\">\n                          <span className=\"font-medium\">Page:</span> {session.current_page}\n                        </p>\n                        {session.question_text && (\n                          <p className=\"text-sm mt-1\">\n                            <span className=\"font-medium\">Current Question:</span>{' '}\n                            {session.question_text}\n                          </p>\n                        )}\n                      </div>\n                      <div className=\"text-right text-sm\">\n                        <p className=\"text-muted-foreground\">\n                          Time: {formatTimeSpent(session.time_spent_seconds)}\n                        </p>\n                        <p className=\"text-muted-foreground text-xs mt-1\">\n                          Last active: {formatDateTime(session.last_active_at)}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </>\n      ) : (\n        <p className=\"text-muted-foreground text-center py-8\">\n          No data available\n        </p>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAPA;;;;;;;AAcO,SAAS,kBAAkB,EAAE,OAAO,EAA0B;;IACnE,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,yKAAQ,EAAC,OAAO,CAAC,EAAE,EAAE,MAAM;IAC3E,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAuB;IACzD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAE3C,wBAAwB;IACxB,MAAM,gBAAgB;QACpB,IAAI,CAAC,kBAAkB;QAEvB,MAAM,SAAS,MAAM,IAAA,8KAAiB,EAAC;QACvC,IAAI,OAAO,OAAO,IAAI,OAAO,IAAI,EAAE;YACjC,SAAS,OAAO,IAAI;QACtB;QACA,aAAa;IACf;IAEA,gBAAgB;IAChB,IAAA,0KAAS;uCAAC;YACR;QACF;sCAAG;QAAC;KAAiB;IAErB,8BAA8B;IAC9B,IAAA,0KAAS;uCAAC;YACR,IAAI,CAAC,kBAAkB;YAEvB,MAAM,UAAU,+IAAQ,CACrB,OAAO,CAAC,CAAC,iBAAiB,EAAE,kBAAkB,EAC9C,EAAE,CACD,oBACA;gBACE,OAAO;gBACP,QAAQ;gBACR,OAAO;gBACP,QAAQ,CAAC,aAAa,EAAE,kBAAkB;YAC5C;uDACA;oBACE,6CAA6C;oBAC7C;gBACF;sDAED,SAAS;YAEZ,2BAA2B;YAC3B,MAAM,WAAW,YAAY,eAAe;YAE5C;+CAAO;oBACL,+IAAQ,CAAC,aAAa,CAAC;oBACvB,cAAc;gBAChB;;QACF;sCAAG;QAAC;KAAiB;IAErB,MAAM,gBAAgB,QAAQ,GAAG,CAAC,CAAC,SAAW,CAAC;YAC7C,OAAO,OAAO,EAAE;YAChB,OAAO,OAAO,KAAK;QACrB,CAAC;IAED,IAAI,QAAQ,MAAM,KAAK,GAAG;QACxB,qBACE,6LAAC;YAAE,WAAU;sBAAyC;;;;;;IAI1D;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC,+IAAM;gBACL,OAAM;gBACN,SAAS;gBACT,OAAO;gBACP,UAAU,CAAC,IAAM,oBAAoB,EAAE,MAAM,CAAC,KAAK;;;;;;YAGpD,0BACC,6LAAC,+JAAc;gBAAC,WAAU;;;;;uBACxB,sBACF;;kCAEE,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAE,WAAU;kDACV,MAAM,kBAAkB;;;;;;kDAE3B,6LAAC;wCAAE,WAAU;kDAAqC;;;;;;;;;;;;0CAKpD,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAE,WAAU;kDACV,MAAM,eAAe,CAAC,MAAM;;;;;;kDAE/B,6LAAC;wCAAE,WAAU;kDAAqC;;;;;;;;;;;;0CAKpD,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAE,WAAU;kDACV,IAAA,yIAAe,EAAC,KAAK,KAAK,CAAC,MAAM,yBAAyB;;;;;;kDAE7D,6LAAC;wCAAE,WAAU;kDAAqC;;;;;;;;;;;;;;;;;;kCAOtD,6LAAC;;0CACC,6LAAC;gCAAG,WAAU;0CAA6B;;;;;;4BAC1C,MAAM,eAAe,CAAC,MAAM,KAAK,kBAChC,6LAAC;gCAAE,WAAU;0CAAyC;;;;;qDAItD,6LAAC;gCAAI,WAAU;0CACZ,MAAM,eAAe,CAAC,GAAG,CAAC,CAAC,wBAC1B,6LAAC;wCAEC,WAAU;kDAEV,cAAA,6LAAC;4CAAI,WAAU;;8DACb,6LAAC;oDAAI,WAAU;;sEACb,6LAAC;4DAAI,WAAU;;8EACb,6LAAC;oEAAI,WAAU;;;;;;8EACf,6LAAC;oEAAK,WAAU;;wEAA0C;wEAC9C,QAAQ,UAAU,CAAC,SAAS,CAAC,GAAG;wEAAI;;;;;;;;;;;;;sEAGlD,6LAAC;4DAAE,WAAU;;8EACX,6LAAC;oEAAK,WAAU;8EAAc;;;;;;gEAAY;gEAAE,QAAQ,YAAY;;;;;;;wDAEjE,QAAQ,aAAa,kBACpB,6LAAC;4DAAE,WAAU;;8EACX,6LAAC;oEAAK,WAAU;8EAAc;;;;;;gEAAyB;gEACtD,QAAQ,aAAa;;;;;;;;;;;;;8DAI5B,6LAAC;oDAAI,WAAU;;sEACb,6LAAC;4DAAE,WAAU;;gEAAwB;gEAC5B,IAAA,yIAAe,EAAC,QAAQ,kBAAkB;;;;;;;sEAEnD,6LAAC;4DAAE,WAAU;;gEAAqC;gEAClC,IAAA,wIAAc,EAAC,QAAQ,cAAc;;;;;;;;;;;;;;;;;;;uCA1BpD,QAAQ,UAAU;;;;;;;;;;;;;;;;;6CAqCnC,6LAAC;gBAAE,WAAU;0BAAyC;;;;;;;;;;;;AAM9D;GAjKgB;KAAA"}}]
}